

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>SISSOkit.evaluation &mdash; SISSOkit 0.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> SISSOkit
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <!-- Local TOC -->
              <div class="local-toc"></div>
            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">SISSOkit</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>SISSOkit.evaluation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for SISSOkit.evaluation</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">utils</span>

<span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">Iterable</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">string</span>
<span class="kn">import</span> <span class="nn">functools</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">json</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>





<div class="viewcode-block" id="evaluate_expression"><a class="viewcode-back" href="../../SISSOkit.html#SISSOkit.evaluation.evaluate_expression">[docs]</a><span class="k">def</span> <span class="nf">evaluate_expression</span><span class="p">(</span><span class="n">expression</span><span class="p">,</span><span class="n">data</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the values using ``expression`` to compute ``data``.</span>
<span class="sd">    </span>
<span class="sd">    Arguments:</span>
<span class="sd">        expression (string): </span>
<span class="sd">            arithmetic expression. </span>
<span class="sd">            The expression should be in the same form as the descriptor in file ``SISSO.out``,</span>
<span class="sd">            i.e., every operation should be enclosed in parenthesis, like (exp((A+B))/((C*D))^2).</span>
<span class="sd">        </span>
<span class="sd">        data (pandas.DataFrame): </span>
<span class="sd">            the data you want to compute, with samples as index and features as columns.</span>
<span class="sd">            The features name should be correspondent to the operands in expression.</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">        pandas.Series: values computed using ``expression``</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">operators</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;+&#39;</span><span class="p">,</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="s1">&#39;*&#39;</span><span class="p">,</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="s1">&#39;exp&#39;</span><span class="p">,</span><span class="s1">&#39;exp-&#39;</span><span class="p">,</span><span class="s1">&#39;^-1&#39;</span><span class="p">,</span><span class="s1">&#39;^2&#39;</span><span class="p">,</span><span class="s1">&#39;^3&#39;</span><span class="p">,</span><span class="s1">&#39;sqrt&#39;</span><span class="p">,</span><span class="s1">&#39;cbrt&#39;</span><span class="p">,</span><span class="s1">&#39;log&#39;</span><span class="p">,</span><span class="s1">&#39;abs&#39;</span><span class="p">,</span><span class="s1">&#39;^6&#39;</span><span class="p">,</span><span class="s1">&#39;sin&#39;</span><span class="p">,</span><span class="s1">&#39;cos&#39;</span><span class="p">,</span><span class="s1">&#39;(&#39;</span><span class="p">,</span><span class="s1">&#39;)&#39;</span><span class="p">]</span>
    <span class="n">OPTR</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">OPND</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">s</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
    <span class="n">i</span><span class="o">=</span><span class="mi">0</span>
    <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">expression</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\w&#39;</span><span class="p">,</span><span class="n">expression</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span>
            <span class="n">s</span><span class="o">+=</span><span class="n">expression</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">expression</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;-&#39;</span> <span class="ow">and</span> <span class="n">expression</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;p&#39;</span><span class="p">:</span>
            <span class="n">s</span><span class="o">+=</span><span class="n">expression</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">s</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">operators</span><span class="p">:</span>
                    <span class="n">OPTR</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">OPND</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">s</span><span class="p">])</span>
                <span class="n">s</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
            <span class="n">OPTR</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">expression</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">expression</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;)&#39;</span><span class="p">:</span>
                <span class="n">OPTR</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="n">expression</span><span class="p">)</span> <span class="ow">and</span> <span class="n">expression</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;^&#39;</span><span class="p">:</span>
                    <span class="n">pattern</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\^-?\d&#39;</span><span class="p">)</span>
                    <span class="n">power</span><span class="o">=</span><span class="n">pattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">expression</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
                    <span class="n">i</span><span class="o">+=</span><span class="nb">len</span><span class="p">(</span><span class="n">power</span><span class="p">)</span>
                    <span class="n">operand</span><span class="o">=</span><span class="n">OPND</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">power</span><span class="o">==</span><span class="s1">&#39;^-1&#39;</span><span class="p">:</span>
                        <span class="n">OPND</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">operand</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">))</span>
                    <span class="k">elif</span> <span class="n">power</span><span class="o">==</span><span class="s1">&#39;^2&#39;</span><span class="p">:</span>
                        <span class="n">OPND</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">operand</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">))</span>
                    <span class="k">elif</span> <span class="n">power</span><span class="o">==</span><span class="s1">&#39;^3&#39;</span><span class="p">:</span>
                        <span class="n">OPND</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">operand</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">))</span>
                    <span class="k">elif</span> <span class="n">power</span><span class="o">==</span><span class="s1">&#39;^6&#39;</span><span class="p">:</span>
                        <span class="n">OPND</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">operand</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">))</span>
                    <span class="n">OPTR</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">OPTR</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">OPTR</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;(&#39;</span><span class="p">:</span>
                    <span class="n">operand</span><span class="o">=</span><span class="n">OPND</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">OPTR</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;exp&#39;</span><span class="p">:</span>
                        <span class="n">OPND</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">operand</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">))</span>
                    <span class="k">elif</span> <span class="n">OPTR</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;exp-&#39;</span><span class="p">:</span>
                        <span class="n">OPND</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">operand</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">))</span>
                    <span class="k">elif</span> <span class="n">OPTR</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;sqrt&#39;</span><span class="p">:</span>
                        <span class="n">OPND</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">operand</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">))</span>
                    <span class="k">elif</span> <span class="n">OPTR</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;cbrt&#39;</span><span class="p">:</span>
                        <span class="n">OPND</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cbrt</span><span class="p">(</span><span class="n">operand</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">))</span>
                    <span class="k">elif</span> <span class="n">OPTR</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;log&#39;</span><span class="p">:</span>
                        <span class="n">OPND</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">operand</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">))</span>
                    <span class="k">elif</span> <span class="n">OPTR</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;abs&#39;</span><span class="p">:</span>
                        <span class="n">OPND</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">operand</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">))</span>
                    <span class="k">elif</span> <span class="n">OPTR</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;sin&#39;</span><span class="p">:</span>
                        <span class="n">OPND</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">operand</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">))</span>
                    <span class="k">elif</span> <span class="n">OPTR</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;cos&#39;</span><span class="p">:</span>
                        <span class="n">OPND</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">operand</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">))</span>
                    <span class="k">elif</span> <span class="n">OPTR</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;(&#39;</span><span class="p">:</span>
                        <span class="n">OPND</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">operand</span><span class="p">)</span>
                        <span class="n">OPTR</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                        <span class="n">i</span><span class="o">+=</span><span class="mi">1</span>
                        <span class="k">continue</span>
                    <span class="n">OPTR</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                    <span class="n">OPTR</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">OPTR</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">OPTR</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;(&#39;</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">operand2</span><span class="o">=</span><span class="n">OPND</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                    <span class="n">operand1</span><span class="o">=</span><span class="n">OPND</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                    <span class="n">operator</span><span class="o">=</span><span class="n">OPTR</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                    <span class="n">OPTR</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">operator</span><span class="o">==</span><span class="s1">&#39;+&#39;</span><span class="p">:</span>
                        <span class="n">OPND</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">operand1</span><span class="o">+</span><span class="n">operand2</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">operator</span><span class="o">==</span><span class="s1">&#39;-&#39;</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">OPTR</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;abs&#39;</span><span class="p">:</span>
                            <span class="n">OPND</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">operand1</span><span class="o">-</span><span class="n">operand2</span><span class="p">))</span>
                            <span class="n">OPTR</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">OPND</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">operand1</span><span class="o">-</span><span class="n">operand2</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">operator</span><span class="o">==</span><span class="s1">&#39;*&#39;</span><span class="p">:</span>
                        <span class="n">OPND</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">operand1</span><span class="o">*</span><span class="n">operand2</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">operator</span><span class="o">==</span><span class="s1">&#39;/&#39;</span><span class="p">:</span>
                        <span class="n">OPND</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">operand1</span><span class="o">/</span><span class="n">operand2</span><span class="p">)</span>
        <span class="n">i</span><span class="o">+=</span><span class="mi">1</span>
    <span class="k">return</span> <span class="n">OPND</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span></div>



<div class="viewcode-block" id="compute_using_model_reg"><a class="viewcode-back" href="../../SISSOkit.html#SISSOkit.evaluation.compute_using_model_reg">[docs]</a><span class="k">def</span> <span class="nf">compute_using_model_reg</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">result</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">training</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">task_idx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">dimension_idx</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Uses SISSO model of specific ``task_idx`` and ``dimension_idx`` to predict property of ``data``.</span>
<span class="sd">    This function is a little bit hard to use, you can also see :meth:`Regression.predict`</span>
<span class="sd">    </span>
<span class="sd">    Arguments:</span>
<span class="sd">        path (string): </span>
<span class="sd">            directory path of SISSO result which contains the model you want to use.</span>
<span class="sd">        </span>
<span class="sd">        result (Regression): </span>
<span class="sd">            instance of Regression which contains the model you want to use.</span>
<span class="sd">        </span>
<span class="sd">        training (bool): </span>
<span class="sd">            whether the task is training or predicting. Default is True.</span>
<span class="sd">        </span>
<span class="sd">        data (string or pandas.DataFrame): </span>
<span class="sd">            the path of the data or the data you want to compute. </span>
<span class="sd">            If it is :class:`string`, it will be recognized as path to the data and </span>
<span class="sd">            use ``data=pd.read_csv(data,sep=r&#39;\s+&#39;)`` to read the data, so remember to use space to seperate the data.</span>
<span class="sd">            Otherwise it should be :class:`pandas.DataFrame`.</span>
<span class="sd">        </span>
<span class="sd">        task_idx (integer): </span>
<span class="sd">            specifies which task of model you want to use.</span>
<span class="sd">        </span>
<span class="sd">        dimension_idx (integer): </span>
<span class="sd">            specifies which dimension of model you want to use.</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">        Values computed using given model. The index order is [task, dimension, sample], it may not include</span>
<span class="sd">        all the index here, depending on you input.</span>
<span class="sd">    </span>
<span class="sd">    .. note::</span>
<span class="sd">        * You should only specify one of ``path`` or ``result`` to determine what model you want to use.</span>
<span class="sd">        </span>
<span class="sd">        * You only need to pass value to ``task_idx`` and ``dimension_idx`` when you want to use specific ``data``.</span>
<span class="sd">        </span>
<span class="sd">        * If you don&#39;t pass value to ``data``, you will get predictions of ``train.dat`` if ``training`` is ``True``</span>
<span class="sd">          or predictions of ``validation.dat`` if ``training`` is ``False``. </span>
<span class="sd">          Also, in this case, you don&#39;t need to pass task_idx and dimension_idx, because you already specify which</span>
<span class="sd">          task of model the sample should use, and it will return all dimension results.</span>
<span class="sd">        </span>
<span class="sd">        * If you pass value to ``data``, then you have to specify ``task_idx``, so it means that</span>
<span class="sd">          all samples should be computed using the same task. </span>
<span class="sd">          If you don&#39;t pass value to ``dimension_idx``, it will return values computed by all the dimension of models,</span>
<span class="sd">          otherwise it will only return values computed using ``dimension_idx`` of model.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">if</span> <span class="n">path</span><span class="p">:</span>
        <span class="n">result</span><span class="o">=</span><span class="n">Regression</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="n">pred</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
            <span class="n">data</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data</span><span class="p">),</span><span class="n">sep</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;\s+&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dimension_idx</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dimension_idx</span><span class="p">):</span>
                <span class="n">value</span><span class="o">+=</span><span class="n">result</span><span class="o">.</span><span class="n">coefficients</span><span class="p">[</span><span class="n">task_idx</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">dimension_idx</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">evaluate_expression</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">descriptors</span><span class="p">[</span><span class="n">dimension_idx</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="n">data</span><span class="p">)</span>
            <span class="n">value</span><span class="o">+=</span><span class="n">result</span><span class="o">.</span><span class="n">intercepts</span><span class="p">[</span><span class="n">task_idx</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">dimension_idx</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">pred</span><span class="o">=</span><span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">dimension</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">dimension</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dimension</span><span class="p">):</span>
                    <span class="n">value</span><span class="o">+=</span><span class="n">result</span><span class="o">.</span><span class="n">coefficients</span><span class="p">[</span><span class="n">task_idx</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">dimension</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">evaluate_expression</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">descriptors</span><span class="p">[</span><span class="n">dimension</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="n">data</span><span class="p">)</span>
                <span class="n">value</span><span class="o">+=</span><span class="n">result</span><span class="o">.</span><span class="n">intercepts</span><span class="p">[</span><span class="n">task_idx</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">dimension</span><span class="p">]</span>
                <span class="n">pred</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="n">pred</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">training</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">n_task</span><span class="p">):</span>
                <span class="n">pred_t</span><span class="o">=</span><span class="p">[]</span>
                <span class="k">for</span> <span class="n">dimension</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">dimension</span><span class="p">):</span>
                    <span class="n">value</span><span class="o">=</span><span class="mi">0</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dimension</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                        <span class="n">value</span><span class="o">+=</span><span class="n">result</span><span class="o">.</span><span class="n">coefficients</span><span class="p">[</span><span class="n">task</span><span class="p">][</span><span class="n">dimension</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">evaluate_expression</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">descriptors</span><span class="p">[</span><span class="n">dimension</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="n">result</span><span class="o">.</span><span class="n">data_task</span><span class="p">[</span><span class="n">task</span><span class="p">])</span>
                    <span class="n">value</span><span class="o">+=</span><span class="n">result</span><span class="o">.</span><span class="n">intercepts</span><span class="p">[</span><span class="n">task</span><span class="p">][</span><span class="n">dimension</span><span class="p">]</span>
                    <span class="n">pred_t</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
                <span class="n">pred</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pred_t</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">n_task</span><span class="p">):</span>
                <span class="n">pred_t</span><span class="o">=</span><span class="p">[]</span>
                <span class="k">for</span> <span class="n">dimension</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">dimension</span><span class="p">):</span>
                    <span class="n">value</span><span class="o">=</span><span class="mi">0</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dimension</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                        <span class="n">value</span><span class="o">+=</span><span class="n">result</span><span class="o">.</span><span class="n">coefficients</span><span class="p">[</span><span class="n">task</span><span class="p">][</span><span class="n">dimension</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">evaluate_expression</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">descriptors</span><span class="p">[</span><span class="n">dimension</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="n">result</span><span class="o">.</span><span class="n">validation_data_task</span><span class="p">[</span><span class="n">task</span><span class="p">])</span>
                    <span class="n">value</span><span class="o">+=</span><span class="n">result</span><span class="o">.</span><span class="n">intercepts</span><span class="p">[</span><span class="n">task</span><span class="p">][</span><span class="n">dimension</span><span class="p">]</span>
                    <span class="n">pred_t</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
                <span class="n">pred</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pred_t</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">pred</span></div>



<div class="viewcode-block" id="predict_reg"><a class="viewcode-back" href="../../SISSOkit.html#SISSOkit.evaluation.predict_reg">[docs]</a><span class="k">def</span> <span class="nf">predict_reg</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">descriptors</span><span class="p">,</span><span class="n">coefficients</span><span class="p">,</span><span class="n">intercepts</span><span class="p">,</span><span class="n">tasks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">dimensions</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the predictions.</span>
<span class="sd">    </span>
<span class="sd">    Arguments:</span>
<span class="sd">        data (string or pandas.DataFrame): </span>
<span class="sd">            the path of the data or the data you want to compute. </span>
<span class="sd">            If it is :class:`string`, it will be recognized as path to the data and </span>
<span class="sd">            use ``data=pd.read_csv(data,sep=r&#39;\s+&#39;)`` to read the data, so remember to use space to seperate the data.</span>
<span class="sd">            Otherwise it should be :class:`pandas.DataFrame`.</span>
<span class="sd">        </span>
<span class="sd">        descriptors (list): </span>
<span class="sd">            the descriptors you want to use. The index order should be dimension of model then dimension of desciptor.</span>
<span class="sd">        </span>
<span class="sd">        coefficients (list): </span>
<span class="sd">            the coefficients you want to use. The index order should be task, dimension of model then dimension of desciptor.</span>
<span class="sd">        </span>
<span class="sd">        intercepts (float or list): </span>
<span class="sd">            the intercepts you want to use. The index order should be task then dimension of model.</span>
<span class="sd">        </span>
<span class="sd">        tasks (None or list): </span>
<span class="sd">            specifies which sample should use which task of model to compute.</span>
<span class="sd">            It should be task=[ [task_index, [sample_indices] ] ].</span>
<span class="sd">            For example, [ [1, [1,3]], [2, [2,4,5]] ] means sample 1 and 3 will be computed using task 1 model,</span>
<span class="sd">            and sample 2, 4 and 5 will be computed using task 2 model.</span>
<span class="sd">            If it is None, then compute all samples with task 1 model.</span>
<span class="sd">        </span>
<span class="sd">        dimensions (None or list): </span>
<span class="sd">            specifies which dimension of desctiptor will be used.</span>
<span class="sd">            For example, [2,5] means only compute using 2D and 5D models.</span>
<span class="sd">            If it is None, then compute all samples with all dimension models.</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">        Predictions using passed models.</span>
<span class="sd">        </span>
<span class="sd">    .. note::</span>
<span class="sd">        * ``intercepts`` should be correspondent to other arguments.</span>
<span class="sd">        </span>
<span class="sd">        * If you just want to use 1 model, then ``descriptors``, ``coefficients`` shoule be a list with string and float as item, </span>
<span class="sd">          and ``intercepts`` should be :class:`float`. You don&#39;t need to set ``tasks`` and ``dimensions`` in this case.</span>
<span class="sd">        </span>
<span class="sd">        * If you want to use many models, ``coefficients`` should be a list and index is different task.</span>
<span class="sd">          Each item in the list should also be a list and index is dimension of the model.</span>
<span class="sd">          Then each item of this list is also a list and index is dimension of descriptor, which contains specific descriptor or coefficient. </span>
<span class="sd">          So the index order should be task, dimension of model then dimension of desciptor.</span>
<span class="sd">          Index order of ``descriptors`` should be dimension of model then dimension of desciptor.</span>
<span class="sd">          Index order of ``intercepts`` should be task then dimension of model.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># if data is string, then read the data.</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
            <span class="n">data</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data</span><span class="p">),</span><span class="n">sep</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;\s+&#39;</span><span class="p">)</span>
    
    <span class="c1"># if the model contains different task and dimension</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">intercepts</span><span class="p">,</span><span class="n">Iterable</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">intercepts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">Iterable</span><span class="p">)):</span>
        
        <span class="c1"># if tasks == None, then data will be computed using the first task</span>
        <span class="k">if</span> <span class="n">tasks</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>
            <span class="n">tasks</span><span class="o">=</span><span class="p">[[</span><span class="mi">1</span><span class="p">,</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)))]]</span>
        
        <span class="c1"># if dimensions == None, then data will be computed using all dimension</span>
        <span class="k">if</span> <span class="n">dimensions</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>
            <span class="n">dimensions</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">intercepts</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
        
        <span class="c1"># compute the number of samples</span>
        <span class="n">n_sample</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">tasks</span><span class="p">:</span>
            <span class="n">n_sample</span><span class="o">+=</span><span class="nb">len</span><span class="p">(</span><span class="n">task</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        
        <span class="c1"># compute the predictions</span>
        <span class="n">pred</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">dimensions</span><span class="p">),</span><span class="n">n_sample</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">tasks</span><span class="p">:</span>
            <span class="n">task_idx</span><span class="o">=</span><span class="n">task</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span>
            <span class="n">sample_idxs</span><span class="o">=</span><span class="n">task</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">d</span><span class="o">=</span><span class="mi">0</span>
            <span class="k">for</span> <span class="n">dimension</span> <span class="ow">in</span> <span class="n">dimensions</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dimension</span><span class="p">):</span>
                    <span class="n">pred</span><span class="p">[</span><span class="n">d</span><span class="p">][</span><span class="n">sample_idxs</span><span class="p">]</span><span class="o">+=</span><span class="n">coefficients</span><span class="p">[</span><span class="n">task_idx</span><span class="p">][</span><span class="n">dimension</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">evaluate_expression</span><span class="p">(</span><span class="n">descriptors</span><span class="p">[</span><span class="n">dimension</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">sample_idxs</span><span class="p">])</span>
                <span class="n">pred</span><span class="p">[</span><span class="n">d</span><span class="p">][</span><span class="n">sample_idxs</span><span class="p">]</span><span class="o">+=</span><span class="n">intercepts</span><span class="p">[</span><span class="n">task_idx</span><span class="p">][</span><span class="n">dimension</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">d</span><span class="o">+=</span><span class="mi">1</span>
    
    <span class="c1"># only 1 model</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">intercepts</span><span class="p">,</span><span class="nb">float</span><span class="p">):</span>
        <span class="n">pred</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">coefficients</span><span class="p">)):</span>
            <span class="n">pred</span><span class="o">+=</span><span class="n">coefficients</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">evaluate_expression</span><span class="p">(</span><span class="n">descriptors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">data</span><span class="p">)</span>
        <span class="n">pred</span><span class="o">+=</span><span class="n">intercepts</span>
    
    <span class="k">return</span> <span class="n">pred</span></div>



<div class="viewcode-block" id="compute_errors"><a class="viewcode-back" href="../../SISSOkit.html#SISSOkit.evaluation.compute_errors">[docs]</a><span class="k">def</span> <span class="nf">compute_errors</span><span class="p">(</span><span class="n">errors</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;    </span>
<span class="sd">    Computes errors.</span>
<span class="sd">    </span>
<span class="sd">    Arguments:</span>
<span class="sd">        errors:</span>
<span class="sd">            difference between predictions and exact value.</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">        RMSE, MAE, 25%ile AE, 50%ile AE, 75%ile AE, 95%ile AE, MaxAE of given errors.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># 1D [sample]</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">errors</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="nb">float</span><span class="p">):</span>
        <span class="n">errors</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">errors</span><span class="p">))</span>
        <span class="n">error</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">errors</span><span class="p">,</span><span class="mi">2</span><span class="p">))),</span>
                                <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">errors</span><span class="p">),</span>
                                <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">errors</span><span class="p">,</span><span class="mi">25</span><span class="p">),</span>
                                <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">errors</span><span class="p">,</span><span class="mi">50</span><span class="p">),</span>
                                <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">errors</span><span class="p">,</span><span class="mi">75</span><span class="p">),</span>
                                <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">errors</span><span class="p">,</span><span class="mi">95</span><span class="p">),</span>
                                <span class="n">errors</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
        <span class="n">error</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">error</span><span class="p">,</span>
                        <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;RMSE&#39;</span><span class="p">,</span><span class="s1">&#39;MAE&#39;</span><span class="p">,</span><span class="s1">&#39;25</span><span class="si">%i</span><span class="s1">le AE&#39;</span><span class="p">,</span><span class="s1">&#39;50</span><span class="si">%i</span><span class="s1">le AE&#39;</span><span class="p">,</span><span class="s1">&#39;75</span><span class="si">%i</span><span class="s1">le AE&#39;</span><span class="p">,</span><span class="s1">&#39;95</span><span class="si">%i</span><span class="s1">le AE&#39;</span><span class="p">,</span><span class="s1">&#39;MaxAE&#39;</span><span class="p">])</span>
    
    <span class="c1"># 3D [task, dimension, sample] or [cv, dimension, sample]</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">errors</span><span class="p">,</span><span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">errors</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">n_task</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span>
        <span class="n">n_dimension</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">errors</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">error</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_task</span><span class="p">):</span>
            <span class="n">error</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">compute_errors</span><span class="p">(</span><span class="n">errors</span><span class="p">[</span><span class="n">task</span><span class="p">][</span><span class="n">dimension</span><span class="p">])</span> <span class="k">for</span> <span class="n">dimension</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_dimension</span><span class="p">)],</span>
                                    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;RMSE&#39;</span><span class="p">,</span><span class="s1">&#39;MAE&#39;</span><span class="p">,</span><span class="s1">&#39;25</span><span class="si">%i</span><span class="s1">le AE&#39;</span><span class="p">,</span><span class="s1">&#39;50</span><span class="si">%i</span><span class="s1">le AE&#39;</span><span class="p">,</span><span class="s1">&#39;75</span><span class="si">%i</span><span class="s1">le AE&#39;</span><span class="p">,</span><span class="s1">&#39;95</span><span class="si">%i</span><span class="s1">le AE&#39;</span><span class="p">,</span><span class="s1">&#39;MaxAE&#39;</span><span class="p">],</span>
                                    <span class="n">index</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">n_dimension</span><span class="o">+</span><span class="mi">1</span><span class="p">))))</span>
    
    <span class="c1"># 4D [cv, task, dimension, sample]</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">errors</span><span class="p">,</span><span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">errors</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="nb">list</span><span class="p">):</span>
        <span class="n">cv_num</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span>
        <span class="n">n_task</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">errors</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">n_dimension</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">errors</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">error</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">cv</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cv_num</span><span class="p">):</span>
            <span class="n">error_cv</span><span class="o">=</span><span class="p">[]</span>
            <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_task</span><span class="p">):</span>
                <span class="n">error_cv</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">compute_errors</span><span class="p">(</span><span class="n">errors</span><span class="p">[</span><span class="n">cv</span><span class="p">][</span><span class="n">task</span><span class="p">][</span><span class="n">dimension</span><span class="p">])</span> <span class="k">for</span> <span class="n">dimension</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_dimension</span><span class="p">)],</span>
                                            <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;RMSE&#39;</span><span class="p">,</span><span class="s1">&#39;MAE&#39;</span><span class="p">,</span><span class="s1">&#39;25</span><span class="si">%i</span><span class="s1">le AE&#39;</span><span class="p">,</span><span class="s1">&#39;50</span><span class="si">%i</span><span class="s1">le AE&#39;</span><span class="p">,</span><span class="s1">&#39;75</span><span class="si">%i</span><span class="s1">le AE&#39;</span><span class="p">,</span><span class="s1">&#39;95</span><span class="si">%i</span><span class="s1">le AE&#39;</span><span class="p">,</span><span class="s1">&#39;MaxAE&#39;</span><span class="p">],</span>
                                            <span class="n">index</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">n_dimension</span><span class="o">+</span><span class="mi">1</span><span class="p">))))</span>
            <span class="n">error</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">error_cv</span><span class="p">)</span>
    
    <span class="c1"># 2D [dimension, sample]</span>
    <span class="k">elif</span> <span class="n">errors</span><span class="o">.</span><span class="n">ndim</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
        <span class="n">n_dimension</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span>
        <span class="n">error</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">compute_errors</span><span class="p">(</span><span class="n">errors</span><span class="p">[</span><span class="n">dimension</span><span class="p">])</span> <span class="k">for</span> <span class="n">dimension</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_dimension</span><span class="p">)],</span>
                            <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;RMSE&#39;</span><span class="p">,</span><span class="s1">&#39;MAE&#39;</span><span class="p">,</span><span class="s1">&#39;25</span><span class="si">%i</span><span class="s1">le AE&#39;</span><span class="p">,</span><span class="s1">&#39;50</span><span class="si">%i</span><span class="s1">le AE&#39;</span><span class="p">,</span><span class="s1">&#39;75</span><span class="si">%i</span><span class="s1">le AE&#39;</span><span class="p">,</span><span class="s1">&#39;95</span><span class="si">%i</span><span class="s1">le AE&#39;</span><span class="p">,</span><span class="s1">&#39;MaxAE&#39;</span><span class="p">],</span>
                            <span class="n">index</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">n_dimension</span><span class="o">+</span><span class="mi">1</span><span class="p">)))</span>
        
    <span class="k">return</span> <span class="n">error</span></div>





<div class="viewcode-block" id="Regression"><a class="viewcode-back" href="../../SISSOkit.html#SISSOkit.evaluation.Regression">[docs]</a><span class="k">class</span> <span class="nc">Regression</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Basic class for evaluating the results of regression. You should instantiate it first.</span>
<span class="sd">    </span>
<span class="sd">    Arguments:</span>
<span class="sd">        current_path (string): </span>
<span class="sd">            path to the directory of the SISSO result.</span>
<span class="sd">    </span>
<span class="sd">    Its attributes contain all the input arguments in ``SISSO.in``, information about ``train.dat``</span>
<span class="sd">    and ``SISSO.out``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">current_path</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_path</span><span class="o">=</span><span class="n">current_path</span>
        
        <span class="c1"># ------------------- read arguments of SISSO.in ----------------------------</span>
        
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_path</span><span class="p">,</span><span class="s1">&#39;SISSO.in&#39;</span><span class="p">),</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">input_file</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            
            <span class="c1"># keywords for the target properties</span>
            <span class="n">n_task</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;ntask\s*=\s*(\d+)&#39;</span><span class="p">,</span><span class="n">input_file</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">n_sample</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;nsample\s*=\s*([\d, ]+)&#39;</span><span class="p">,</span><span class="n">input_file</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">n_sample</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[,\s]+&#39;</span><span class="p">,</span><span class="n">n_sample</span><span class="p">)</span>
            <span class="n">n_sample</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\d&#39;</span><span class="p">,</span><span class="n">x</span><span class="p">)),</span><span class="n">n_sample</span><span class="p">))</span>
            <span class="c1">#if n_sample[-1]==&#39;&#39;:</span>
            <span class="c1">#    n_sample=n_sample[:-1]</span>
            <span class="n">n_sample</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span><span class="n">n_sample</span><span class="p">))</span>
            <span class="n">task_weighting</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;task_weighting\s*=\s*(\d+)&#39;</span><span class="p">,</span><span class="n">input_file</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">dimension</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;desc_dim\s*=\s*(\d+)&#39;</span><span class="p">,</span><span class="n">input_file</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            
            <span class="c1"># keywords for feature construction and sure independence screening</span>
            <span class="n">rung</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;rung\s*=\s*(\d+)&#39;</span><span class="p">,</span><span class="n">input_file</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">operation_set</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;opset\s*=\s*&#39;(.+)&#39;&quot;</span><span class="p">,</span><span class="n">input_file</span><span class="p">)</span>
            <span class="n">operation_set</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[\(\)]+&#39;</span><span class="p">,</span><span class="n">operation_set</span><span class="p">[</span><span class="mi">0</span><span class="p">])[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">maxcomplexity</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;maxcomplexity\s*=\s*(\d+)&#39;</span><span class="p">,</span><span class="n">input_file</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">dimclass</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;dimclass=([\(\d:\)]+)&#39;</span><span class="p">,</span><span class="n">input_file</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">maxfval_lb</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;maxfval_lb\s*=\s*(\d+.\d+|\d+[eE]-?\d+)&#39;</span><span class="p">,</span><span class="n">input_file</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">maxfval_ub</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;maxfval_ub\s*=\s*(\d+.\d+|\d+[eE]-?\d+)&#39;</span><span class="p">,</span><span class="n">input_file</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">subs_sis</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;subs_sis\s*=\s*(\d+)&#39;</span><span class="p">,</span><span class="n">input_file</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            
            <span class="c1"># keywords for descriptor</span>
            <span class="n">method</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;method\s*=\s*</span><span class="se">\&#39;</span><span class="s1">(\w+)&#39;</span><span class="p">,</span><span class="n">input_file</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">L1L0_size4LO</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;L1L0_size4L0\s*=\s*(\d+)&#39;</span><span class="p">,</span><span class="n">input_file</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">fit_intercept</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;fit_intercept\s*=\s*.(\w+).&#39;</span><span class="p">,</span><span class="n">input_file</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">fit_intercept</span><span class="o">==</span><span class="s1">&#39;true&#39;</span><span class="p">:</span>
                <span class="n">fit_intercept</span><span class="o">=</span><span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fit_intercept</span><span class="o">=</span><span class="kc">False</span>
            <span class="n">metric</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;metric\s*=\s*</span><span class="se">\&#39;</span><span class="s1">(\w+)&#39;</span><span class="p">,</span><span class="n">input_file</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">nm_output</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;nm_output\s*=\s*(\d+)&#39;</span><span class="p">,</span><span class="n">input_file</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        
        <span class="c1"># keywords for the target properties</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_task</span><span class="o">=</span><span class="n">n_task</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_sample</span><span class="o">=</span><span class="n">n_sample</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">task_weighting</span><span class="o">=</span><span class="n">task_weighting</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dimension</span><span class="o">=</span><span class="n">dimension</span>
        
        <span class="c1"># keywords for feature construction and sure independence screening</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rung</span><span class="o">=</span><span class="n">rung</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">operation_set</span><span class="o">=</span><span class="n">operation_set</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxcomplexity</span><span class="o">=</span><span class="n">maxcomplexity</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dimclass</span><span class="o">=</span><span class="n">dimclass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxfval_lb</span><span class="o">=</span><span class="n">maxfval_lb</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxfval_ub</span><span class="o">=</span><span class="n">maxfval_ub</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subs_sis</span><span class="o">=</span><span class="n">subs_sis</span>
        
        <span class="c1"># keywords for descriptor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">method</span><span class="o">=</span><span class="n">method</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">L1L0_size4LO</span><span class="o">=</span><span class="n">L1L0_size4LO</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fit_intercept</span><span class="o">=</span><span class="n">fit_intercept</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metric</span><span class="o">=</span><span class="n">metric</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nm_output</span><span class="o">=</span><span class="n">nm_output</span>
        
        <span class="c1"># ------------------------------ read data --------------------------------</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_path</span><span class="p">,</span><span class="s1">&#39;train.dat&#39;</span><span class="p">),</span><span class="n">sep</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;\s+&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">property</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">property_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">features_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="mi">2</span><span class="p">:]</span>
        
        
        <span class="c1"># -------------------------- read data per task ----------------------------</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">data_task</span><span class="o">=</span><span class="n">utils</span><span class="o">.</span><span class="n">seperate_DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">n_sample</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">materials_task</span><span class="o">=</span><span class="n">utils</span><span class="o">.</span><span class="n">seperate_DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">n_sample</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">property_task</span><span class="o">=</span><span class="n">utils</span><span class="o">.</span><span class="n">seperate_DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">property</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">n_sample</span><span class="p">)</span>
        
        <span class="c1"># ------------------------- read validation data ---------------------------</span>
        
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_path</span><span class="p">,</span><span class="s1">&#39;validation.dat&#39;</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">validation_data</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_path</span><span class="p">,</span><span class="s1">&#39;validation.dat&#39;</span><span class="p">),</span><span class="n">sep</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;\s+&#39;</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_path</span><span class="p">,</span><span class="s1">&#39;shuffle.dat&#39;</span><span class="p">),</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">shuffle</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">n_sample</span><span class="o">=</span><span class="n">shuffle</span><span class="p">[</span><span class="s1">&#39;training_samples_number&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">n_validation_sample</span><span class="o">=</span><span class="n">shuffle</span><span class="p">[</span><span class="s1">&#39;validation_samples_number&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">validation_data_task</span><span class="o">=</span><span class="n">utils</span><span class="o">.</span><span class="n">seperate_DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">validation_data</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">n_validation_sample</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">text</span><span class="o">=</span><span class="s1">&#39;#&#39;</span><span class="o">*</span><span class="mi">50</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span><span class="s1">&#39;SISSO Regression</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span><span class="s1">&#39;#&#39;</span><span class="o">*</span><span class="mi">50</span>
        <span class="n">text</span><span class="o">+=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Property Name: </span><span class="si">%s</span><span class="se">\n</span><span class="s1">Sample Number: </span><span class="si">%d</span><span class="se">\n</span><span class="s1">Task Number: </span><span class="si">%d</span><span class="se">\n</span><span class="s1">Rung: </span><span class="si">%d</span><span class="se">\n</span><span class="s1">Dimension: </span><span class="si">%d</span><span class="se">\n</span><span class="s1">Subs_sis: </span><span class="si">%d</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">property_name</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">n_sample</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">n_task</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">rung</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">dimension</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">subs_sis</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">text</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">baseline</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the baseline, i.e., the errors with predicting every property using the mean value of the property in ``train.dat``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">errors</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">property</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">property</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="n">errors</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">property</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">property</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">errors</span><span class="p">),</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">errors</span><span class="p">,</span><span class="mi">25</span><span class="p">),</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">errors</span><span class="p">,</span><span class="mi">50</span><span class="p">),</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">errors</span><span class="p">,</span><span class="mi">75</span><span class="p">),</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">errors</span><span class="p">,</span><span class="mi">95</span><span class="p">),</span>
                        <span class="n">errors</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">errors</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span><span class="s1">&#39;std&#39;</span><span class="p">,</span><span class="s1">&#39;MAE&#39;</span><span class="p">,</span><span class="s1">&#39;25</span><span class="si">%i</span><span class="s1">le AE&#39;</span><span class="p">,</span><span class="s1">&#39;50</span><span class="si">%i</span><span class="s1">le AE&#39;</span><span class="p">,</span><span class="s1">&#39;75</span><span class="si">%i</span><span class="s1">le AE&#39;</span><span class="p">,</span><span class="s1">&#39;95</span><span class="si">%i</span><span class="s1">le AE&#39;</span><span class="p">,</span><span class="s1">&#39;MaxAE&#39;</span><span class="p">])</span>
    
<div class="viewcode-block" id="Regression.get_descriptors"><a class="viewcode-back" href="../../SISSOkit.html#SISSOkit.evaluation.Regression.get_descriptors">[docs]</a>    <span class="k">def</span> <span class="nf">get_descriptors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns descriptors.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="n">path</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>
            <span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">current_path</span>
        <span class="n">descriptors_all</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s1">&#39;SISSO.out&#39;</span><span class="p">),</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">input_file</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="n">descriptors_total</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;descriptor:[\s\S]*?coefficients&#39;</span><span class="p">,</span><span class="n">input_file</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">dimension</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">dimension</span><span class="p">):</span>
                <span class="n">descriptors_d</span><span class="o">=</span><span class="n">descriptors_total</span><span class="p">[</span><span class="n">dimension</span><span class="p">]</span>
                <span class="n">descriptors_d</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\s+&#39;</span><span class="p">,</span><span class="n">descriptors_d</span><span class="p">)</span>
                <span class="n">descriptors_d</span><span class="o">=</span><span class="n">descriptors_d</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">dimension</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">descriptors_d</span><span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;:&#39;</span><span class="p">,</span><span class="n">x</span><span class="p">),</span><span class="n">descriptors_d</span><span class="p">))]</span>
                <span class="n">descriptors_d</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;(&#39;</span><span class="p">),</span><span class="n">descriptors_d</span><span class="p">))</span>
                <span class="n">descriptors_d</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;]&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;)&#39;</span><span class="p">),</span><span class="n">descriptors_d</span><span class="p">))</span>
                <span class="n">descriptors_all</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">descriptors_d</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">descriptors_all</span></div>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">descriptors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns descriptors.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_descriptors</span><span class="p">()</span>
    
<div class="viewcode-block" id="Regression.get_coefficients"><a class="viewcode-back" href="../../SISSOkit.html#SISSOkit.evaluation.Regression.get_coefficients">[docs]</a>    <span class="k">def</span> <span class="nf">get_coefficients</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns coefficients. The index order is task, dimension of model, dimension descriptor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="n">path</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>
            <span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">current_path</span>
        <span class="n">coefficients_all</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">n_task</span><span class="p">):</span>
            <span class="n">coefficients_t</span><span class="o">=</span><span class="p">[]</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s1">&#39;SISSO.out&#39;</span><span class="p">),</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">input_file</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                <span class="n">coefficients_total</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;coefficients_00</span><span class="si">%d</span><span class="s1">:(.*)&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">task</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">input_file</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">dimension</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">dimension</span><span class="p">):</span>
                    <span class="n">coefficients_d</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\s+&#39;</span><span class="p">,</span><span class="n">coefficients_total</span><span class="p">[</span><span class="n">dimension</span><span class="p">])[</span><span class="mi">1</span><span class="p">:]</span>
                    <span class="n">coefficients_d</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span><span class="n">coefficients_d</span><span class="p">))</span>
                    <span class="n">coefficients_t</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coefficients_d</span><span class="p">)</span>
            <span class="n">coefficients_all</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coefficients_t</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">coefficients_all</span></div>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">coefficients</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns coefficients. The index order is task, dimension of model, dimension descriptor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_coefficients</span><span class="p">()</span>
    
<div class="viewcode-block" id="Regression.get_intercepts"><a class="viewcode-back" href="../../SISSOkit.html#SISSOkit.evaluation.Regression.get_intercepts">[docs]</a>    <span class="k">def</span> <span class="nf">get_intercepts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns intercepts. The index order is task, dimension of model.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="n">path</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>
            <span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">current_path</span>
        <span class="n">intercepts_all</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">n_task</span><span class="p">):</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s1">&#39;SISSO.out&#39;</span><span class="p">),</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">input_file</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                <span class="n">intercepts_t</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Intercept_00</span><span class="si">%d</span><span class="s1">:(.*)&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">task</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">input_file</span><span class="p">)</span>
                <span class="n">intercepts_t</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span><span class="n">intercepts_t</span><span class="p">))</span>
            <span class="n">intercepts_all</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">intercepts_t</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">intercepts_all</span></div>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">intercepts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns intercepts. The index order is task, dimension of model.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_intercepts</span><span class="p">()</span>
    
<div class="viewcode-block" id="Regression.features_percent"><a class="viewcode-back" href="../../SISSOkit.html#SISSOkit.evaluation.Regression.features_percent">[docs]</a>    <span class="k">def</span> <span class="nf">features_percent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">descending</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Computes the percentages of each feature in top subs_sis 1D descriptors.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">feature_space</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_path</span><span class="p">,</span><span class="s1">&#39;feature_space&#39;</span><span class="p">,</span><span class="s1">&#39;Uspace.name&#39;</span><span class="p">),</span><span class="n">sep</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;\s+&#39;</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">subs_sis</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">feature_percent</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">features_name</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;percent&#39;</span><span class="p">,))</span>
        <span class="k">for</span> <span class="n">feature_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">features_name</span><span class="p">:</span>
            <span class="n">percent</span><span class="o">=</span><span class="n">feature_space</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">feature_name</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">subs_sis</span>
            <span class="n">feature_percent</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;percent&#39;</span><span class="p">,</span><span class="n">feature_name</span><span class="p">]</span><span class="o">=</span><span class="n">percent</span>
        <span class="n">feature_percent</span><span class="o">=</span><span class="n">feature_percent</span><span class="o">.</span><span class="n">T</span>
        <span class="k">if</span> <span class="n">descending</span><span class="p">:</span>
            <span class="n">feature_percent</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;percent&#39;</span><span class="p">,</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">feature_percent</span></div>
    
<div class="viewcode-block" id="Regression.evaluate_expression"><a class="viewcode-back" href="../../SISSOkit.html#SISSOkit.evaluation.Regression.evaluate_expression">[docs]</a>    <span class="k">def</span> <span class="nf">evaluate_expression</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">expression</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the value computed using given expression over data in ``train.dat``.</span>
<span class="sd">        </span>
<span class="sd">        Returns the values using ``expression`` to compute ``data``.</span>
<span class="sd">    </span>
<span class="sd">        Arguments:</span>
<span class="sd">            expression (string): </span>
<span class="sd">            arithmetic expression. </span>
<span class="sd">                The expression should be in the same form as the descriptor in file ``SISSO.out``,</span>
<span class="sd">                i.e., every operation should be enclosed in parenthesis, like (exp((A+B))/((C*D))^2).</span>
<span class="sd">            </span>
<span class="sd">            data (pandas.DataFrame): </span>
<span class="sd">                the data you want to compute, with samples as index and features as columns.</span>
<span class="sd">                The features name should be correspondent to the operands in expression.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            pandas.Series: values computed using ``expression``</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
            <span class="n">data</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data</span><span class="p">),</span><span class="n">sep</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;\s+&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">data</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span>
        <span class="k">return</span> <span class="n">evaluate_expression</span><span class="p">(</span><span class="n">expression</span><span class="p">,</span><span class="n">data</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="Regression.predict"><a class="viewcode-back" href="../../SISSOkit.html#SISSOkit.evaluation.Regression.predict">[docs]</a>    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data</span><span class="p">,</span><span class="n">tasks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">dimensions</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the predictions of ``data`` using the models found by SISSO.</span>
<span class="sd">        </span>
<span class="sd">        Arguments:</span>
<span class="sd">            data (string or pandas.DataFrame): </span>
<span class="sd">                the path of the data or the data you want to compute. </span>
<span class="sd">                If it is :class:`string`, it will be recognized as path to the data and </span>
<span class="sd">                use ``data=pd.read_csv(data,sep=r&#39;\s+&#39;)`` to read the data, so remember to use space to seperate the data.</span>
<span class="sd">                Otherwise it should be :class:`pandas.DataFrame`.</span>
<span class="sd">            </span>
<span class="sd">            tasks (None or list):  </span>
<span class="sd">                specifies which sample should use which task of model to compute.</span>
<span class="sd">                It should be task=[ [task_index, [sample_indices] ] ].</span>
<span class="sd">                For example, [ [1, [1,3]], [2, [2,4,5]] ] means sample 1 and 3 will be computed using task 1 model,</span>
<span class="sd">                and sample 2, 4 and 5 will be computed using task 2 model.</span>
<span class="sd">                If it is None, then compute all samples with task 1 model.</span>
<span class="sd">            </span>
<span class="sd">            dimensions (None or list):  </span>
<span class="sd">                specifies which dimension of desctiptor will be used.</span>
<span class="sd">                For example, [2,5] means only compute using 2D and 5D models.</span>
<span class="sd">                If it is None, then compute all samples with all dimension models.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            Values computed using models found by SISSO.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
            <span class="n">data</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data</span><span class="p">),</span><span class="n">sep</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;\s+&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">predict_reg</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">descriptors</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">coefficients</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">intercepts</span><span class="p">,</span><span class="n">tasks</span><span class="o">=</span><span class="n">tasks</span><span class="p">,</span><span class="n">dimensions</span><span class="o">=</span><span class="n">dimensions</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="Regression.predictions"><a class="viewcode-back" href="../../SISSOkit.html#SISSOkit.evaluation.Regression.predictions">[docs]</a>    <span class="k">def</span> <span class="nf">predictions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">training</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">display_task</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns predictions.</span>
<span class="sd">        The index order is dimension, sample if ``display_task`` is ``False``,</span>
<span class="sd">        or task, sample, dimension if ``display_task`` is ``True``.</span>
<span class="sd">        </span>
<span class="sd">        Arguments:</span>
<span class="sd">            training (bool):  </span>
<span class="sd">                determines whether its training or not.</span>
<span class="sd">            </span>
<span class="sd">            display_task (bool):  </span>
<span class="sd">                determines the predictions contain index of task or not.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            Predictions.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="n">display_task</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">compute_using_model_reg</span><span class="p">(</span><span class="n">result</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span><span class="n">training</span><span class="o">=</span><span class="n">training</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span><span class="n">compute_using_model_reg</span><span class="p">(</span><span class="n">result</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span><span class="n">training</span><span class="o">=</span><span class="n">training</span><span class="p">))</span></div>
    
<div class="viewcode-block" id="Regression.errors"><a class="viewcode-back" href="../../SISSOkit.html#SISSOkit.evaluation.Regression.errors">[docs]</a>    <span class="k">def</span> <span class="nf">errors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">training</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">display_task</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns errors.</span>
<span class="sd">            The index order is dimension, sample if ``display_task`` is ``False``,</span>
<span class="sd">            or task, sample, dimension if ``display_task`` is ``True``.</span>
<span class="sd">        </span>
<span class="sd">        Arguments:</span>
<span class="sd">            training (bool):  </span>
<span class="sd">                determines whether its training or not.</span>
<span class="sd">            </span>
<span class="sd">            display_task (bool):  </span>
<span class="sd">                determines the errors contain index of task or not.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            Errors.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="n">display_task</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
            <span class="n">pred</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">predictions</span><span class="p">(</span><span class="n">training</span><span class="o">=</span><span class="n">training</span><span class="p">,</span><span class="n">display_task</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">pred</span><span class="p">[</span><span class="n">task</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">property_task</span><span class="p">[</span><span class="n">task</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">n_task</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">training</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">predictions</span><span class="p">(</span><span class="n">training</span><span class="o">=</span><span class="n">training</span><span class="p">,</span><span class="n">display_task</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">property</span><span class="o">.</span><span class="n">values</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">predictions</span><span class="p">(</span><span class="n">training</span><span class="o">=</span><span class="n">training</span><span class="p">,</span><span class="n">display_task</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">validation_data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">values</span></div>
    
<div class="viewcode-block" id="Regression.total_errors"><a class="viewcode-back" href="../../SISSOkit.html#SISSOkit.evaluation.Regression.total_errors">[docs]</a>    <span class="k">def</span> <span class="nf">total_errors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">training</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">display_task</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">display_baseline</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;    </span>
<span class="sd">        Computes errors.</span>
<span class="sd">        </span>
<span class="sd">        Arguments:</span>
<span class="sd">            training (bool):  </span>
<span class="sd">                determines whether its training or not.</span>
<span class="sd">            </span>
<span class="sd">            display_task (bool):  </span>
<span class="sd">                determines the errors contain index of task or not.</span>
<span class="sd">            </span>
<span class="sd">            display_baseline (bool):  </span>
<span class="sd">                determines whether display baseline</span>
<span class="sd">            </span>
<span class="sd">        Returns:</span>
<span class="sd">            RMSE, MAE, 25%ile AE, 50%ile AE, 75%ile AE, 95%ile AE, MaxAE of given errors.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="n">display_baseline</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">baseline</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                                        <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Baseline&#39;</span><span class="p">],</span>
                                        <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;RMSE&#39;</span><span class="p">,</span><span class="s1">&#39;MAE&#39;</span><span class="p">,</span><span class="s1">&#39;25</span><span class="si">%i</span><span class="s1">le AE&#39;</span><span class="p">,</span><span class="s1">&#39;50</span><span class="si">%i</span><span class="s1">le AE&#39;</span><span class="p">,</span><span class="s1">&#39;75</span><span class="si">%i</span><span class="s1">le AE&#39;</span><span class="p">,</span><span class="s1">&#39;95</span><span class="si">%i</span><span class="s1">le AE&#39;</span><span class="p">,</span><span class="s1">&#39;MaxAE&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
                            <span class="n">compute_errors</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="p">(</span><span class="n">training</span><span class="o">=</span><span class="n">training</span><span class="p">,</span><span class="n">display_task</span><span class="o">=</span><span class="n">display_task</span><span class="p">))])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">compute_errors</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="p">(</span><span class="n">training</span><span class="o">=</span><span class="n">training</span><span class="p">,</span><span class="n">display_task</span><span class="o">=</span><span class="n">display_task</span><span class="p">))</span></div>
        
<div class="viewcode-block" id="Regression.check_predictions"><a class="viewcode-back" href="../../SISSOkit.html#SISSOkit.evaluation.Regression.check_predictions">[docs]</a>    <span class="k">def</span> <span class="nf">check_predictions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">dimension</span><span class="p">,</span><span class="n">multiply_coefficients</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks predictions of each descriptor.</span>
<span class="sd">        </span>
<span class="sd">        Arguments:  </span>
<span class="sd">            dimension (int):</span>
<span class="sd">                dimension of the descriptor.</span>
<span class="sd">                </span>
<span class="sd">            multiply_coefficients (bool):  </span>
<span class="sd">                whether it should be multiplied by coefficients.</span>
<span class="sd">            </span>
<span class="sd">        Returns:</span>
<span class="sd">            Predictions of each descriptor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">descriptors</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">descriptors</span>
        <span class="n">coefficients</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">coefficients</span>
        <span class="n">n_sample</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n_sample</span>
        <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data_task</span>
        <span class="n">predictions</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">dimension</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">n_sample</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()])</span>
        <span class="n">total_n_sample</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">n_sample</span><span class="p">)):</span>
            <span class="n">predictions</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">total_n_sample</span><span class="p">:</span><span class="n">total_n_sample</span><span class="o">+</span><span class="n">n_sample</span><span class="p">[</span><span class="n">task</span><span class="p">]]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">intercepts</span><span class="p">[</span><span class="n">task</span><span class="p">][</span><span class="n">dimension</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">total_n_sample</span><span class="o">+=</span><span class="n">n_sample</span><span class="p">[</span><span class="n">task</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">multiply_coefficients</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dimension</span><span class="p">):</span>
                <span class="n">total_n_sample</span><span class="o">=</span><span class="mi">0</span>
                <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">n_sample</span><span class="p">)):</span>
                    <span class="n">predictions</span><span class="p">[</span><span class="n">d</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">total_n_sample</span><span class="p">:</span><span class="n">total_n_sample</span><span class="o">+</span><span class="n">n_sample</span><span class="p">[</span><span class="n">task</span><span class="p">]]</span><span class="o">=</span><span class="n">coefficients</span><span class="p">[</span><span class="n">task</span><span class="p">][</span><span class="n">dimension</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">d</span><span class="p">]</span><span class="o">*</span><span class="n">evaluate_expression</span><span class="p">(</span><span class="n">descriptors</span><span class="p">[</span><span class="n">dimension</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">d</span><span class="p">],</span><span class="n">data</span><span class="p">[</span><span class="n">task</span><span class="p">])</span><span class="o">.</span><span class="n">values</span>
                    <span class="n">total_n_sample</span><span class="o">+=</span><span class="n">n_sample</span><span class="p">[</span><span class="n">task</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dimension</span><span class="p">):</span>
                <span class="n">total_n_sample</span><span class="o">=</span><span class="mi">0</span>
                <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">n_sample</span><span class="p">)):</span>
                    <span class="n">predictions</span><span class="p">[</span><span class="n">d</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">total_n_sample</span><span class="p">:</span><span class="n">total_n_sample</span><span class="o">+</span><span class="n">n_sample</span><span class="p">[</span><span class="n">task</span><span class="p">]]</span><span class="o">=</span><span class="n">evaluate_expression</span><span class="p">(</span><span class="n">descriptors</span><span class="p">[</span><span class="n">dimension</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">d</span><span class="p">],</span><span class="n">data</span><span class="p">[</span><span class="n">task</span><span class="p">])</span><span class="o">.</span><span class="n">values</span>
                    <span class="n">total_n_sample</span><span class="o">+=</span><span class="n">n_sample</span><span class="p">[</span><span class="n">task</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">predictions</span></div>
    
<div class="viewcode-block" id="Regression.check_percentage"><a class="viewcode-back" href="../../SISSOkit.html#SISSOkit.evaluation.Regression.check_percentage">[docs]</a>    <span class="k">def</span> <span class="nf">check_percentage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">dimension</span><span class="p">,</span><span class="n">absolute</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks percentage of each descriptors.</span>
<span class="sd">        </span>
<span class="sd">        Arguments:  </span>
<span class="sd">            dimension (int):</span>
<span class="sd">                dimension of the descriptor.</span>
<span class="sd">                </span>
<span class="sd">            absolute (bool):</span>
<span class="sd">                whether return the absolute descriptor.</span>
<span class="sd">                If it is ``True``, the numerator is absolute value of each descriptor multiplied by corresponding coefficient,</span>
<span class="sd">                and denominator is the sum of intercept and every descriptor multiplied by coefficient.</span>
<span class="sd">                If it is ``False``, the numerator is descriptor multiplied by corresponding coefficient,</span>
<span class="sd">                and denominator is the proeprty. In this case, sometimes it will be larger than 1.</span>
<span class="sd">                </span>
<span class="sd">        Returns:</span>
<span class="sd">            percentage which index is [dimension, sample].</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">predictions</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">check_predictions</span><span class="p">(</span><span class="n">dimension</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">absolute</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">predictions</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">predictions</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">predictions</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">property</span><span class="o">.</span><span class="n">values</span></div></div>





<div class="viewcode-block" id="RegressionCV"><a class="viewcode-back" href="../../SISSOkit.html#SISSOkit.evaluation.RegressionCV">[docs]</a><span class="k">class</span> <span class="nc">RegressionCV</span><span class="p">(</span><span class="n">Regression</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Basic class for evaluating the cross validation results of regression.</span>
<span class="sd">    You should instantiate it first if you want to analyze CV results.</span>
<span class="sd">    You can use index to select a specific result from total CV results, and it will return</span>
<span class="sd">    a instance of :class:`Regression`.</span>
<span class="sd">    </span>
<span class="sd">    Arguments:</span>
<span class="sd">        current_path (string):  </span>
<span class="sd">            path to the directory of the cross validation results.</span>
<span class="sd">        </span>
<span class="sd">        property_name (string):  </span>
<span class="sd">            specifies the property name of your CV results.</span>
<span class="sd">        </span>
<span class="sd">        drop_index (list):  </span>
<span class="sd">            specifies which CV results you don&#39;t want to consider.</span>
<span class="sd">    </span>
<span class="sd">    .. note::</span>
<span class="sd">        You should use code in ``cross_validation.py`` to generate the CV files, otherwise the format</span>
<span class="sd">        may be wrong. </span>
<span class="sd">        </span>
<span class="sd">        Its attributes contain all the input arguments in ``SISSO.in``, information about ``train.dat``,</span>
<span class="sd">        ``validation.dat``, and ``SISSO.out``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">current_path</span><span class="p">,</span><span class="n">property_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">drop_index</span><span class="o">=</span><span class="p">[]):</span>
        <span class="c1"># -------------------------- read path and CV info----------------------------</span>
        <span class="n">cv_names</span><span class="o">=</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s1">&#39;_cv&#39;</span> <span class="ow">in</span> <span class="n">x</span><span class="p">,</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">current_path</span><span class="p">))),</span>
                        <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_cv&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">dir_list</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">cv_name</span><span class="p">:</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_path</span><span class="p">,</span><span class="n">cv_name</span><span class="p">),</span><span class="n">cv_names</span><span class="p">))</span>
        <span class="n">n_cv</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">cv_names</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">current_path</span><span class="o">=</span><span class="n">current_path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cv_path</span><span class="o">=</span><span class="p">[</span><span class="n">dir_list</span><span class="p">[</span><span class="n">cv</span><span class="p">]</span> <span class="k">for</span> <span class="n">cv</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_cv</span><span class="p">)</span> <span class="k">if</span> <span class="n">cv</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">drop_index</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">drop_index</span><span class="o">=</span><span class="n">drop_index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_cv</span><span class="o">=</span><span class="n">n_cv</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">drop_index</span><span class="p">)</span>
        
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_path</span><span class="p">,</span><span class="s1">&#39;cross_validation_info.dat&#39;</span><span class="p">),</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">cv_info</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cross_validation_type</span><span class="o">=</span><span class="n">cv_info</span><span class="p">[</span><span class="s1">&#39;cross_validation_type&#39;</span><span class="p">]</span>
        
        <span class="c1"># ------------------- read arguments of SISSO.in ----------------------------</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv_path</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="s1">&#39;SISSO.in&#39;</span><span class="p">),</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">input_file</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            
            <span class="c1"># keywords for the target properties</span>
            <span class="n">n_task</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;ntask\s*=\s*(\d+)&#39;</span><span class="p">,</span><span class="n">input_file</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">task_weighting</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;task_weighting\s*=\s*(\d+)&#39;</span><span class="p">,</span><span class="n">input_file</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">dimension</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;desc_dim\s*=\s*(\d+)&#39;</span><span class="p">,</span><span class="n">input_file</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            
            <span class="c1"># keywords for feature construction and sure independence screening</span>
            <span class="n">rung</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;rung\s*=\s*(\d+)&#39;</span><span class="p">,</span><span class="n">input_file</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">operation_set</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;opset\s*=\s*&#39;(.+)&#39;&quot;</span><span class="p">,</span><span class="n">input_file</span><span class="p">)</span>
            <span class="n">operation_set</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[\(\)]+&#39;</span><span class="p">,</span><span class="n">operation_set</span><span class="p">[</span><span class="mi">0</span><span class="p">])[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">maxcomplexity</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;maxcomplexity\s*=\s*(\d+)&#39;</span><span class="p">,</span><span class="n">input_file</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">dimclass</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;dimclass=([\(\d:\)]+)&#39;</span><span class="p">,</span><span class="n">input_file</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">maxfval_lb</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;maxfval_lb\s*=\s*(\d+.\d+|\d+[eE]-?\d+)&#39;</span><span class="p">,</span><span class="n">input_file</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">maxfval_ub</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;maxfval_ub\s*=\s*(\d+.\d+|\d+[eE]-?\d+)&#39;</span><span class="p">,</span><span class="n">input_file</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">subs_sis</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;subs_sis\s*=\s*(\d+)&#39;</span><span class="p">,</span><span class="n">input_file</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            
            <span class="c1"># keywords for descriptor</span>
            <span class="n">method</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;method\s*=\s*</span><span class="se">\&#39;</span><span class="s1">(\w+)&#39;</span><span class="p">,</span><span class="n">input_file</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">L1L0_size4LO</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;L1L0_size4L0\s*=\s*(\d+)&#39;</span><span class="p">,</span><span class="n">input_file</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">fit_intercept</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;fit_intercept\s*=\s*.(\w+).&#39;</span><span class="p">,</span><span class="n">input_file</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">fit_intercept</span><span class="o">==</span><span class="s1">&#39;true&#39;</span><span class="p">:</span>
                <span class="n">fit_intercept</span><span class="o">=</span><span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fit_intercept</span><span class="o">=</span><span class="kc">False</span>
            <span class="n">metric</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;metric\s*=\s*</span><span class="se">\&#39;</span><span class="s1">(\w+)&#39;</span><span class="p">,</span><span class="n">input_file</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">nm_output</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;nm_output\s*=\s*(\d+)&#39;</span><span class="p">,</span><span class="n">input_file</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        
        <span class="c1"># keywords for the target properties</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_task</span><span class="o">=</span><span class="n">n_task</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">task_weighting</span><span class="o">=</span><span class="n">task_weighting</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dimension</span><span class="o">=</span><span class="n">dimension</span>
        
        <span class="c1"># keywords for feature construction and sure independence screening</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rung</span><span class="o">=</span><span class="n">rung</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">operation_set</span><span class="o">=</span><span class="n">operation_set</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxcomplexity</span><span class="o">=</span><span class="n">maxcomplexity</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dimclass</span><span class="o">=</span><span class="n">dimclass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxfval_lb</span><span class="o">=</span><span class="n">maxfval_lb</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxfval_ub</span><span class="o">=</span><span class="n">maxfval_ub</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subs_sis</span><span class="o">=</span><span class="n">subs_sis</span>
        
        <span class="c1"># keywords for descriptor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">method</span><span class="o">=</span><span class="n">method</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">L1L0_size4LO</span><span class="o">=</span><span class="n">L1L0_size4LO</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fit_intercept</span><span class="o">=</span><span class="n">fit_intercept</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metric</span><span class="o">=</span><span class="n">metric</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nm_output</span><span class="o">=</span><span class="n">nm_output</span>
        
        <span class="c1"># --------------------------- read total data -----------------------------</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">total_data</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_path</span><span class="p">,</span><span class="s1">&#39;train.dat&#39;</span><span class="p">),</span><span class="n">sep</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;\s+&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_total_sample</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_path</span><span class="p">,</span><span class="s1">&#39;train.dat&#39;</span><span class="p">),</span><span class="n">sep</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;\s+&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">property_name</span><span class="o">=</span><span class="n">property_name</span> <span class="k">if</span> <span class="n">property_name</span> <span class="k">else</span> <span class="n">cv_names</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_cv&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        
        <span class="c1"># -------------------------- read data per CV -----------------------------</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cv_path</span><span class="p">,</span><span class="s1">&#39;train.dat&#39;</span><span class="p">),</span><span class="n">sep</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;\s+&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">cv_path</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv_path</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="o">=</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">property</span><span class="o">=</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">features_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="mi">2</span><span class="p">:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_sample</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cv_path</span><span class="p">,</span><span class="s1">&#39;shuffle.dat&#39;</span><span class="p">),</span><span class="s1">&#39;r&#39;</span><span class="p">))[</span><span class="s1">&#39;training_samples_number&#39;</span><span class="p">]</span>
                        <span class="k">for</span> <span class="n">cv_path</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv_path</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_validation_sample</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cv_path</span><span class="p">,</span><span class="s1">&#39;shuffle.dat&#39;</span><span class="p">),</span><span class="s1">&#39;r&#39;</span><span class="p">))[</span><span class="s1">&#39;validation_samples_number&#39;</span><span class="p">]</span>
                        <span class="k">for</span> <span class="n">cv_path</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv_path</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validation_data</span><span class="o">=</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cv_path</span><span class="p">,</span><span class="s1">&#39;validation.dat&#39;</span><span class="p">),</span><span class="n">sep</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;\s+&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">cv_path</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv_path</span><span class="p">]</span>
        
        <span class="c1"># --------------------- read data per CV per task ------------------------</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">data_task</span><span class="o">=</span><span class="p">[</span><span class="n">utils</span><span class="o">.</span><span class="n">seperate_DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">cv</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">n_sample</span><span class="p">[</span><span class="n">cv</span><span class="p">])</span>
                        <span class="k">for</span> <span class="n">cv</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">n_cv</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">materials_task</span><span class="o">=</span><span class="p">[</span><span class="n">utils</span><span class="o">.</span><span class="n">seperate_DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="p">[</span><span class="n">cv</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">n_sample</span><span class="p">[</span><span class="n">cv</span><span class="p">])</span>
                        <span class="k">for</span> <span class="n">cv</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">n_cv</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">property_task</span><span class="o">=</span><span class="p">[</span><span class="n">utils</span><span class="o">.</span><span class="n">seperate_DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">property</span><span class="p">[</span><span class="n">cv</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">n_sample</span><span class="p">[</span><span class="n">cv</span><span class="p">])</span>
                        <span class="k">for</span> <span class="n">cv</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">n_cv</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validation_data_task</span><span class="o">=</span><span class="p">[</span><span class="n">utils</span><span class="o">.</span><span class="n">seperate_DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">validation_data</span><span class="p">[</span><span class="n">cv</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">n_validation_sample</span><span class="p">[</span><span class="n">cv</span><span class="p">])</span>
                        <span class="k">for</span> <span class="n">cv</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">n_cv</span><span class="p">)]</span>
    
    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">index</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span><span class="nb">slice</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">Regression</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv_path</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">index</span><span class="o">.</span><span class="n">start</span><span class="p">,</span><span class="n">index</span><span class="o">.</span><span class="n">stop</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Regression</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv_path</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
    
    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">text</span><span class="o">=</span><span class="s1">&#39;#&#39;</span><span class="o">*</span><span class="mi">50</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span><span class="s1">&#39;SISSO Regression CV</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span><span class="s1">&#39;#&#39;</span><span class="o">*</span><span class="mi">50</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_path</span><span class="p">,</span><span class="s1">&#39;cross_validation_info.dat&#39;</span><span class="p">),</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">cv_info</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;shuffle_data_list&#39;</span> <span class="ow">in</span> <span class="n">cv_info</span><span class="p">:</span>
            <span class="n">text</span><span class="o">+=</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Cross Validation Type: </span><span class="si">%s</span><span class="se">\n</span><span class="s1">Shuffle Data List: &#39;</span><span class="o">%</span><span class="n">cv_info</span><span class="p">[</span><span class="s1">&#39;cross_validation_type&#39;</span><span class="p">]</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">cv_info</span><span class="p">[</span><span class="s1">&#39;shuffle_data_list&#39;</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">text</span><span class="o">+=</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Cross Validation Type: </span><span class="si">%s</span><span class="se">\n</span><span class="s1">Iteration: &#39;</span><span class="o">%</span><span class="n">cv_info</span><span class="p">[</span><span class="s1">&#39;cross_validation_type&#39;</span><span class="p">]</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_cv</span><span class="p">))</span>
        <span class="n">text</span><span class="o">+=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Property Name: </span><span class="si">%s</span><span class="se">\n</span><span class="s1">Task Number: </span><span class="si">%d</span><span class="se">\n</span><span class="s1">Rung: </span><span class="si">%d</span><span class="se">\n</span><span class="s1">Dimension: </span><span class="si">%d</span><span class="se">\n</span><span class="s1">Subs_sis: </span><span class="si">%d</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">property_name</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">n_task</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">rung</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">dimension</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">subs_sis</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">text</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">baseline</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the baseline, i.e., the errors with predicting every property using the mean value of the property in ``train.dat``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">total_property</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">total_data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">errors</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">((</span><span class="n">total_property</span><span class="o">-</span><span class="n">total_property</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="n">errors</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">total_property</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
                        <span class="n">total_property</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">errors</span><span class="p">),</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">errors</span><span class="p">,</span><span class="mi">25</span><span class="p">),</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">errors</span><span class="p">,</span><span class="mi">50</span><span class="p">),</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">errors</span><span class="p">,</span><span class="mi">75</span><span class="p">),</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">errors</span><span class="p">,</span><span class="mi">95</span><span class="p">),</span>
                        <span class="n">errors</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">errors</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span><span class="s1">&#39;std&#39;</span><span class="p">,</span><span class="s1">&#39;MAE&#39;</span><span class="p">,</span><span class="s1">&#39;25</span><span class="si">%i</span><span class="s1">le AE&#39;</span><span class="p">,</span><span class="s1">&#39;50</span><span class="si">%i</span><span class="s1">le AE&#39;</span><span class="p">,</span><span class="s1">&#39;75</span><span class="si">%i</span><span class="s1">le AE&#39;</span><span class="p">,</span><span class="s1">&#39;95</span><span class="si">%i</span><span class="s1">le AE&#39;</span><span class="p">,</span><span class="s1">&#39;MaxAE&#39;</span><span class="p">])</span>
    
<div class="viewcode-block" id="RegressionCV.find_materials_in_validation"><a class="viewcode-back" href="../../SISSOkit.html#SISSOkit.evaluation.RegressionCV.find_materials_in_validation">[docs]</a>    <span class="k">def</span> <span class="nf">find_materials_in_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">*</span><span class="n">idxs</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the samples&#39; names and in which CV result they are.</span>
<span class="sd">        </span>
<span class="sd">        Arguments:</span>
<span class="sd">            idx (integer):  </span>
<span class="sd">                index of the sample.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            the samples&#39; names and in which CV result they are.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cross_validation_type</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;leave&#39;</span><span class="p">):</span>
            <span class="n">val_num</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">validation_data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">return</span> <span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">validation_data</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">index</span><span class="o">/</span><span class="n">val_num</span><span class="p">)]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">index</span><span class="o">%</span><span class="n">val_num</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">idxs</span><span class="p">],</span>
                    <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv_path</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">index</span><span class="o">/</span><span class="n">val_num</span><span class="p">)]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;cv&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">idxs</span><span class="p">])</span></div>
    
<div class="viewcode-block" id="RegressionCV.find_max_error"><a class="viewcode-back" href="../../SISSOkit.html#SISSOkit.evaluation.RegressionCV.find_max_error">[docs]</a>    <span class="k">def</span> <span class="nf">find_max_error</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the samples&#39; names and in which CV result they are that contribute to the maxAE.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_materials_in_validation</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="p">(</span><span class="n">training</span><span class="o">=</span><span class="kc">False</span><span class="p">)),</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)))</span></div>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">descriptors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns descriptors. The first index is cross validation index.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">return</span> <span class="p">[</span><span class="nb">super</span><span class="p">(</span><span class="n">RegressionCV</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_descriptors</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">cv_path</span><span class="p">)</span> <span class="k">for</span> <span class="n">cv_path</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv_path</span><span class="p">]</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">coefficients</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns coefficients. The index order is CV index, task, dimension of model, dimension descriptor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">return</span> <span class="p">[</span><span class="nb">super</span><span class="p">(</span><span class="n">RegressionCV</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_coefficients</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">cv_path</span><span class="p">)</span> <span class="k">for</span> <span class="n">cv_path</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv_path</span><span class="p">]</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">intercepts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns intercepts. The index order is CV index, task, dimension of model.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">return</span> <span class="p">[</span><span class="nb">super</span><span class="p">(</span><span class="n">RegressionCV</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_intercepts</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">cv_path</span><span class="p">)</span> <span class="k">for</span> <span class="n">cv_path</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv_path</span><span class="p">]</span>
    
<div class="viewcode-block" id="RegressionCV.features_percent"><a class="viewcode-back" href="../../SISSOkit.html#SISSOkit.evaluation.RegressionCV.features_percent">[docs]</a>    <span class="k">def</span> <span class="nf">features_percent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">descending</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the percent of each feature in the top subs_sis descriptors.</span>
<span class="sd">        There are total n_cv*subs_sis descriptors,</span>
<span class="sd">        the feature percent is the percent over these descriptors.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">feature_percent</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">features_name</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;percent&#39;</span><span class="p">,))</span>
        <span class="n">feature_percent</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">for</span> <span class="n">cv_path</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv_path</span><span class="p">:</span>
            <span class="n">feature_space</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cv_path</span><span class="p">,</span><span class="s1">&#39;feature_space&#39;</span><span class="p">,</span><span class="s1">&#39;Uspace.name&#39;</span><span class="p">),</span><span class="n">sep</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;\s+&#39;</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">subs_sis</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">feature_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">features_name</span><span class="p">:</span>
                <span class="n">count</span><span class="o">=</span><span class="n">feature_space</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">feature_name</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                <span class="n">feature_percent</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;percent&#39;</span><span class="p">,</span><span class="n">feature_name</span><span class="p">]</span><span class="o">+=</span><span class="n">count</span>
        <span class="n">feature_percent</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span><span class="o">=</span><span class="n">feature_percent</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_cv</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">subs_sis</span><span class="p">)</span>
        <span class="n">feature_percent</span><span class="o">=</span><span class="n">feature_percent</span><span class="o">.</span><span class="n">T</span>
        <span class="k">if</span> <span class="n">descending</span><span class="p">:</span>
            <span class="n">feature_percent</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;percent&#39;</span><span class="p">,</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">feature_percent</span></div>
    
<div class="viewcode-block" id="RegressionCV.descriptor_percent"><a class="viewcode-back" href="../../SISSOkit.html#SISSOkit.evaluation.RegressionCV.descriptor_percent">[docs]</a>    <span class="k">def</span> <span class="nf">descriptor_percent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">descriptor</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the percent of given descriptor appearing in the cross validation top subs_sis descriptors,</span>
<span class="sd">        and return the appearing index in the descriptor space.</span>
<span class="sd">        </span>
<span class="sd">        Arguments:</span>
<span class="sd">            descriptor (string):  </span>
<span class="sd">                the descriptor you want to check.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">count</span><span class="o">=</span><span class="mi">0</span>
        <span class="n">descriptor_index</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_cv</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">cv</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">n_cv</span><span class="p">):</span>
            <span class="n">feature_space</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv_path</span><span class="p">[</span><span class="n">cv</span><span class="p">],</span><span class="s1">&#39;feature_space&#39;</span><span class="p">,</span><span class="s1">&#39;Uspace.name&#39;</span><span class="p">),</span><span class="n">sep</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;\s+&#39;</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">subs_sis</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">descriptor_index</span><span class="p">[</span><span class="n">cv</span><span class="p">]</span><span class="o">=</span><span class="n">feature_space</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">descriptor</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>
                <span class="n">count</span><span class="o">+=</span><span class="mi">1</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="n">descriptor_index</span><span class="p">[</span><span class="n">cv</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span>
        <span class="k">return</span> <span class="n">count</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">n_cv</span><span class="p">,</span><span class="n">descriptor_index</span></div>
    
<div class="viewcode-block" id="RegressionCV.predict"><a class="viewcode-back" href="../../SISSOkit.html#SISSOkit.evaluation.RegressionCV.predict">[docs]</a>    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data</span><span class="p">,</span><span class="n">cv_index</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">tasks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">dimensions</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the predictions of ``data`` using the models found by SISSO.</span>
<span class="sd">        </span>
<span class="sd">        Arguments:</span>
<span class="sd">            data (string or pandas.DataFrame):  </span>
<span class="sd">                the path of the data or the data you want to compute. </span>
<span class="sd">                If it is :class:`string`, it will be recognized as path to the data and </span>
<span class="sd">                use ``data=pd.read_csv(data,sep=r&#39;\s+&#39;)`` to read the data, so remember to use space to seperate the data.</span>
<span class="sd">                Otherwise it should be :class:`pandas.DataFrame`.</span>
<span class="sd">            </span>
<span class="sd">            cv_index (None or list): </span>
<span class="sd">                specifies which CV should be included.</span>
<span class="sd">                For example, [1,5] means CV1 and CV5 will be included.</span>
<span class="sd">                If it is None, then compute all CV results.</span>
<span class="sd">            </span>
<span class="sd">            tasks (None or list):  </span>
<span class="sd">                specifies which sample should use which task of model to compute.</span>
<span class="sd">                It should be task=[ [task_index, [sample_indices] ] ].</span>
<span class="sd">                For example, [ [1, [1,3]], [2, [2,4,5]] ] means sample 1 and 3 will be computed using task 1 model,</span>
<span class="sd">                and sample 2, 4 and 5 will be computed using task 2 model.</span>
<span class="sd">                If it is None, then compute all samples with task 1 model.</span>
<span class="sd">            </span>
<span class="sd">            dimensions (None or list):  </span>
<span class="sd">                specifies which dimension of desctiptor will be used.</span>
<span class="sd">                For example, [2,5] means only compute using 2D and 5D models.</span>
<span class="sd">                If it is None, then compute all samples with all dimension models.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            Values computed using models found by SISSO.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="n">cv_index</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>
            <span class="n">cv_index</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_cv</span><span class="p">))</span>
        
        <span class="k">return</span> <span class="p">[</span><span class="n">predict_reg</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">descriptors</span><span class="p">[</span><span class="n">cv</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">coefficients</span><span class="p">[</span><span class="n">cv</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">intercepts</span><span class="p">[</span><span class="n">cv</span><span class="p">],</span><span class="n">tasks</span><span class="o">=</span><span class="n">tasks</span><span class="p">,</span><span class="n">dimensions</span><span class="o">=</span><span class="n">dimensions</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">cv</span> <span class="ow">in</span> <span class="n">cv_index</span><span class="p">]</span></div>
    
<div class="viewcode-block" id="RegressionCV.predictions"><a class="viewcode-back" href="../../SISSOkit.html#SISSOkit.evaluation.RegressionCV.predictions">[docs]</a>    <span class="k">def</span> <span class="nf">predictions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">training</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">display_cv</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">display_task</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns predictions.</span>
<span class="sd">        The index order is dimension, sample if ``display_cv`` is ``False`` and ``display_task`` is ``False``,</span>
<span class="sd">        or task, sample, dimension if ``display_cv`` is ``False`` and ``display_task`` is ``True``,</span>
<span class="sd">        or CV index, sample, dimension if ``display_cv`` is ``True`` and ``display_task`` is ``False``,</span>
<span class="sd">        or CV index, task, sample, dimension if ``display_cv`` is ``True`` and ``display_task`` is ``True``.</span>
<span class="sd">        </span>
<span class="sd">        Arguments:</span>
<span class="sd">            training (bool):  </span>
<span class="sd">                determines whether its training or not.</span>
<span class="sd">            </span>
<span class="sd">            display_task (bool):  </span>
<span class="sd">                determines the predictions contain index of task or not.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            Predictions.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="n">display_cv</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">display_task</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[</span><span class="n">compute_using_model_reg</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">cv_path</span><span class="p">,</span>
                                        <span class="n">training</span><span class="o">=</span><span class="n">training</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">cv_path</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv_path</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span><span class="n">compute_using_model_reg</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">cv_path</span><span class="p">,</span>
                                        <span class="n">training</span><span class="o">=</span><span class="n">training</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">cv_path</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv_path</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">predictions</span><span class="p">(</span><span class="n">training</span><span class="o">=</span><span class="n">training</span><span class="p">,</span><span class="n">display_cv</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">display_task</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span></div>
    
<div class="viewcode-block" id="RegressionCV.errors"><a class="viewcode-back" href="../../SISSOkit.html#SISSOkit.evaluation.RegressionCV.errors">[docs]</a>    <span class="k">def</span> <span class="nf">errors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">training</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">display_cv</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">display_task</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns errors.</span>
<span class="sd">        The index order is dimension, sample if ``display_cv`` is ``False`` and ``display_task`` is ``False``,</span>
<span class="sd">        or task, sample, dimension if ``display_cv`` is ``False`` and ``display_task`` is ``True``,</span>
<span class="sd">        or CV index, sample, dimension if ``display_cv`` is ``True`` and ``display_task`` is ``False``,</span>
<span class="sd">        or CV index, task, sample, dimension if ``display_cv`` is ``True`` and ``display_task`` is ``True``.</span>
<span class="sd">        </span>
<span class="sd">        Arguments:</span>
<span class="sd">            training (bool):  </span>
<span class="sd">                determines whether its training or not.</span>
<span class="sd">            </span>
<span class="sd">            display_task (bool):  </span>
<span class="sd">                determines the errors contain index of task or not.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            Errors.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="n">display_cv</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">training</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">display_task</span><span class="p">:</span>
                    <span class="n">error</span><span class="o">=</span><span class="p">[]</span>
                    <span class="n">pred</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">predictions</span><span class="p">(</span><span class="n">training</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">display_cv</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">display_task</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">cv</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_cv</span><span class="p">):</span>
                        <span class="n">error_cv</span><span class="o">=</span><span class="p">[]</span>
                        <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">n_task</span><span class="p">):</span>
                            <span class="n">error_cv</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pred</span><span class="p">[</span><span class="n">cv</span><span class="p">][</span><span class="n">task</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">property_task</span><span class="p">[</span><span class="n">cv</span><span class="p">][</span><span class="n">task</span><span class="p">])</span>
                        <span class="n">error</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">error_cv</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">error</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">pred</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">predictions</span><span class="p">(</span><span class="n">training</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">display_cv</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">display_task</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">return</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span><span class="n">pred</span><span class="p">[</span><span class="n">cv</span><span class="p">])</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">property_task</span><span class="p">[</span><span class="n">cv</span><span class="p">])</span>
                            <span class="k">for</span> <span class="n">cv</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_cv</span><span class="p">)]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">display_task</span><span class="p">:</span>
                    <span class="n">error</span><span class="o">=</span><span class="p">[]</span>
                    <span class="n">pred</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">predictions</span><span class="p">(</span><span class="n">training</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">display_cv</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">display_task</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">cv</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">n_cv</span><span class="p">):</span>
                        <span class="n">error_cv</span><span class="o">=</span><span class="p">[]</span>
                        <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_task</span><span class="p">):</span>
                            <span class="n">error_cv</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pred</span><span class="p">[</span><span class="n">cv</span><span class="p">][</span><span class="n">task</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">validation_data_task</span><span class="p">[</span><span class="n">cv</span><span class="p">][</span><span class="n">task</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
                        <span class="n">error</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">error_cv</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">error</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">pred</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">predictions</span><span class="p">(</span><span class="n">training</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">display_cv</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">display_task</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">return</span> <span class="p">[(</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span><span class="n">pred</span><span class="p">[</span><span class="n">cv</span><span class="p">])</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">validation_data</span><span class="p">[</span><span class="n">cv</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
                            <span class="k">for</span> <span class="n">cv</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_cv</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">display_task</span><span class="p">:</span>
                <span class="n">errors_cv_t</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="p">(</span><span class="n">training</span><span class="o">=</span><span class="n">training</span><span class="p">,</span><span class="n">display_cv</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">display_task</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">errors</span><span class="o">=</span><span class="p">[]</span>
                <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_task</span><span class="p">):</span>
                    <span class="n">errors_t</span><span class="o">=</span><span class="n">errors_cv_t</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">task</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">cv</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">n_cv</span><span class="p">):</span>
                        <span class="n">errors_t</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">errors_t</span><span class="p">,</span><span class="n">errors_cv_t</span><span class="p">[</span><span class="n">cv</span><span class="p">][</span><span class="n">task</span><span class="p">]))</span>
                    <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">errors_t</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">errors</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="p">(</span><span class="n">training</span><span class="o">=</span><span class="n">training</span><span class="p">,</span><span class="n">display_cv</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">display_task</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span></div>
        
<div class="viewcode-block" id="RegressionCV.total_errors"><a class="viewcode-back" href="../../SISSOkit.html#SISSOkit.evaluation.RegressionCV.total_errors">[docs]</a>    <span class="k">def</span> <span class="nf">total_errors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">training</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">display_cv</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">display_task</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">display_baseline</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;    </span>
<span class="sd">        Compute errors.</span>
<span class="sd">        </span>
<span class="sd">        Arguments:</span>
<span class="sd">            training (bool):  </span>
<span class="sd">                determines whether its training or not.</span>
<span class="sd">            </span>
<span class="sd">            display_cv (bool):  </span>
<span class="sd">                determines the errors contain index of CV or not.</span>
<span class="sd">            </span>
<span class="sd">            display_task (bool):  </span>
<span class="sd">                determines the errors contain index of task or not.</span>
<span class="sd">            </span>
<span class="sd">            display_baseline (bool):  </span>
<span class="sd">                determines whether display baseline</span>
<span class="sd">            </span>
<span class="sd">        Returns:</span>
<span class="sd">            RMSE, MAE, 25%ile AE, 50%ile AE, 75%ile AE, 95%ile AE, MaxAE of given errors.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="n">display_baseline</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">training</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">baseline</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                                        <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Baseline&#39;</span><span class="p">],</span>
                                        <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;RMSE&#39;</span><span class="p">,</span><span class="s1">&#39;MAE&#39;</span><span class="p">,</span><span class="s1">&#39;25</span><span class="si">%i</span><span class="s1">le AE&#39;</span><span class="p">,</span><span class="s1">&#39;50</span><span class="si">%i</span><span class="s1">le AE&#39;</span><span class="p">,</span><span class="s1">&#39;75</span><span class="si">%i</span><span class="s1">le AE&#39;</span><span class="p">,</span><span class="s1">&#39;95</span><span class="si">%i</span><span class="s1">le AE&#39;</span><span class="p">,</span><span class="s1">&#39;MaxAE&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
                                <span class="n">compute_errors</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="p">(</span><span class="n">training</span><span class="o">=</span><span class="n">training</span><span class="p">,</span><span class="n">display_cv</span><span class="o">=</span><span class="n">display_cv</span><span class="p">,</span><span class="n">display_task</span><span class="o">=</span><span class="n">display_task</span><span class="p">))])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">baseline</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                                        <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Baseline&#39;</span><span class="p">],</span>
                                        <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;RMSE&#39;</span><span class="p">,</span><span class="s1">&#39;MAE&#39;</span><span class="p">,</span><span class="s1">&#39;25</span><span class="si">%i</span><span class="s1">le AE&#39;</span><span class="p">,</span><span class="s1">&#39;50</span><span class="si">%i</span><span class="s1">le AE&#39;</span><span class="p">,</span><span class="s1">&#39;75</span><span class="si">%i</span><span class="s1">le AE&#39;</span><span class="p">,</span><span class="s1">&#39;95</span><span class="si">%i</span><span class="s1">le AE&#39;</span><span class="p">,</span><span class="s1">&#39;MaxAE&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
                                <span class="n">compute_errors</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="p">(</span><span class="n">training</span><span class="o">=</span><span class="n">training</span><span class="p">,</span><span class="n">display_cv</span><span class="o">=</span><span class="n">display_cv</span><span class="p">,</span><span class="n">display_task</span><span class="o">=</span><span class="n">display_task</span><span class="p">))])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">training</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">compute_errors</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="p">(</span><span class="n">training</span><span class="o">=</span><span class="n">training</span><span class="p">,</span><span class="n">display_cv</span><span class="o">=</span><span class="n">display_cv</span><span class="p">,</span><span class="n">display_task</span><span class="o">=</span><span class="n">display_task</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">compute_errors</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="p">(</span><span class="n">training</span><span class="o">=</span><span class="n">training</span><span class="p">,</span><span class="n">display_cv</span><span class="o">=</span><span class="n">display_cv</span><span class="p">,</span><span class="n">display_task</span><span class="o">=</span><span class="n">display_task</span><span class="p">))</span></div>
        
<div class="viewcode-block" id="RegressionCV.drop"><a class="viewcode-back" href="../../SISSOkit.html#SISSOkit.evaluation.RegressionCV.drop">[docs]</a>    <span class="k">def</span> <span class="nf">drop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="p">[]):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Drop some CV results.</span>
<span class="sd">        </span>
<span class="sd">        Arguments:</span>
<span class="sd">            index (list):  </span>
<span class="sd">                contain the CV index which you want to drop.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            An instance of RegressionCV that drop the results in CV index.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">index</span><span class="o">+=</span><span class="bp">self</span><span class="o">.</span><span class="n">drop_index</span>
        <span class="k">return</span> <span class="n">RegressionCV</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_path</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">property_name</span><span class="p">,</span><span class="n">index</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="RegressionCV.check_predictions"><a class="viewcode-back" href="../../SISSOkit.html#SISSOkit.evaluation.RegressionCV.check_predictions">[docs]</a>    <span class="k">def</span> <span class="nf">check_predictions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">cv_idx</span><span class="p">,</span><span class="n">dimension</span><span class="p">,</span><span class="n">training</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">multiply_coefficients</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check predictions of each descriptor.</span>
<span class="sd">        </span>
<span class="sd">        Arguments:</span>
<span class="sd">            cv_idx (integer):  </span>
<span class="sd">                specifies which CV result you want to check.</span>
<span class="sd">                </span>
<span class="sd">            dimension (int):</span>
<span class="sd">                dimension of the descriptor.</span>
<span class="sd">            </span>
<span class="sd">            training (bool):  </span>
<span class="sd">                whether it is training.</span>
<span class="sd">            </span>
<span class="sd">            multiply_coefficients (bool):  </span>
<span class="sd">                whether it should be multiplied by coefficients.</span>
<span class="sd">            </span>
<span class="sd">        Returns</span>
<span class="sd">            Predictions of each descriptor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">descriptors</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">descriptors</span><span class="p">[</span><span class="n">cv_idx</span><span class="p">]</span>
        <span class="n">coefficients</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">coefficients</span><span class="p">[</span><span class="n">cv_idx</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">training</span><span class="p">:</span>
            <span class="n">n_sample</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n_sample</span><span class="p">[</span><span class="n">cv_idx</span><span class="p">]</span>
            <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data_task</span><span class="p">[</span><span class="n">cv_idx</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">n_sample</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n_validation_sample</span><span class="p">[</span><span class="n">cv_idx</span><span class="p">]</span>
            <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">validation_data_task</span><span class="p">[</span><span class="n">cv_idx</span><span class="p">]</span>
        <span class="n">predictions</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">dimension</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">n_sample</span><span class="o">.</span><span class="n">sum</span><span class="p">()])</span>
        <span class="n">total_n_sample</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">n_sample</span><span class="p">)):</span>
            <span class="n">predictions</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">total_n_sample</span><span class="p">:</span><span class="n">total_n_sample</span><span class="o">+</span><span class="n">n_sample</span><span class="p">[</span><span class="n">task</span><span class="p">]]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">intercepts</span><span class="p">[</span><span class="n">cv_idx</span><span class="p">][</span><span class="n">task</span><span class="p">][</span><span class="n">dimension</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">total_n_sample</span><span class="o">+=</span><span class="n">n_sample</span><span class="p">[</span><span class="n">task</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">multiply_coefficients</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dimension</span><span class="p">):</span>
                <span class="n">total_n_sample</span><span class="o">=</span><span class="mi">0</span>
                <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">n_sample</span><span class="p">)):</span>
                    <span class="n">predictions</span><span class="p">[</span><span class="n">d</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">total_n_sample</span><span class="p">:</span><span class="n">total_n_sample</span><span class="o">+</span><span class="n">n_sample</span><span class="p">[</span><span class="n">task</span><span class="p">]]</span><span class="o">=</span><span class="n">coefficients</span><span class="p">[</span><span class="n">task</span><span class="p">][</span><span class="n">dimension</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">d</span><span class="p">]</span><span class="o">*</span><span class="n">evaluate_expression</span><span class="p">(</span><span class="n">descriptors</span><span class="p">[</span><span class="n">dimension</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">d</span><span class="p">],</span><span class="n">data</span><span class="p">[</span><span class="n">task</span><span class="p">])</span><span class="o">.</span><span class="n">values</span>
                    <span class="n">total_n_sample</span><span class="o">+=</span><span class="n">n_sample</span><span class="p">[</span><span class="n">task</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dimension</span><span class="p">):</span>
                <span class="n">total_n_sample</span><span class="o">=</span><span class="mi">0</span>
                <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">n_sample</span><span class="p">)):</span>
                    <span class="n">predictions</span><span class="p">[</span><span class="n">d</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">total_n_sample</span><span class="p">:</span><span class="n">total_n_sample</span><span class="o">+</span><span class="n">n_sample</span><span class="p">[</span><span class="n">task</span><span class="p">]]</span><span class="o">=</span><span class="n">evaluate_expression</span><span class="p">(</span><span class="n">descriptors</span><span class="p">[</span><span class="n">dimension</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">d</span><span class="p">],</span><span class="n">data</span><span class="p">[</span><span class="n">task</span><span class="p">])</span><span class="o">.</span><span class="n">values</span>
                    <span class="n">total_n_sample</span><span class="o">+=</span><span class="n">n_sample</span><span class="p">[</span><span class="n">task</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">predictions</span></div>
    
<div class="viewcode-block" id="RegressionCV.check_percentage"><a class="viewcode-back" href="../../SISSOkit.html#SISSOkit.evaluation.RegressionCV.check_percentage">[docs]</a>    <span class="k">def</span> <span class="nf">check_percentage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">cv_idx</span><span class="p">,</span><span class="n">dimension</span><span class="p">,</span><span class="n">absolute</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks percentage of each descriptors.</span>
<span class="sd">        </span>
<span class="sd">        Arguments:  </span>
<span class="sd">            dimension (int):</span>
<span class="sd">                dimension of the descriptor.</span>
<span class="sd">                </span>
<span class="sd">            absolute (bool):</span>
<span class="sd">                whether return the absolute descriptor.</span>
<span class="sd">                If it is ``True``, the numerator is absolute value of each descriptor multiplied by corresponding coefficient,</span>
<span class="sd">                and denominator is the sum of intercept and every descriptor multiplied by coefficient.</span>
<span class="sd">                If it is ``False``, the numerator is descriptor multiplied by corresponding coefficient,</span>
<span class="sd">                and denominator is the proeprty. In this case, sometimes it will be larger than 1.</span>
<span class="sd">                </span>
<span class="sd">        Returns:</span>
<span class="sd">            percentage which index is [dimension, sample].</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">predictions</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">check_predictions</span><span class="p">(</span><span class="n">cv_idx</span><span class="p">,</span><span class="n">dimension</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">absolute</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">predictions</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">predictions</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">predictions</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">property</span><span class="p">[</span><span class="n">cv_idx</span><span class="p">]</span><span class="o">.</span><span class="n">values</span></div></div>





<div class="viewcode-block" id="Classification"><a class="viewcode-back" href="../../SISSOkit.html#SISSOkit.evaluation.Classification">[docs]</a><span class="k">class</span> <span class="nc">Classification</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Basic class for evaluating the results of classification. You should instantiate it first.</span>
<span class="sd">    </span>
<span class="sd">    Arguments:</span>
<span class="sd">        current_path (string):  </span>
<span class="sd">            path to the directory of the SISSO result.</span>
<span class="sd">    </span>
<span class="sd">    Its attributes contain all the input arguments in ``SISSO.in``, information about ``train.dat``</span>
<span class="sd">    and ``SISSO.out``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">current_path</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_path</span><span class="o">=</span><span class="n">current_path</span>
        
        <span class="c1"># ------------------- read arguments of SISSO.in ----------------------------</span>
        
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_path</span><span class="p">,</span><span class="s1">&#39;SISSO.in&#39;</span><span class="p">),</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">input_file</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            
            <span class="c1"># keywords for the target properties</span>
            <span class="n">n_task</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;ntask\s*=\s*(\d+)&#39;</span><span class="p">,</span><span class="n">input_file</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">n_sample</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;nsample\s*=\s*([\(\)\d,\s]*)\)&#39;</span><span class="p">,</span><span class="n">input_file</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">n_sample</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\(|\s&#39;</span><span class="p">,</span><span class="n">n_sample</span><span class="p">)</span>
            <span class="n">n_sample</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\d&#39;</span><span class="p">,</span><span class="n">x</span><span class="p">)),</span><span class="n">n_sample</span><span class="p">))</span>
            <span class="n">n_sample</span><span class="o">=</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">d</span><span class="p">),</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\d&#39;</span><span class="p">,</span><span class="n">x</span><span class="p">)),</span><span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;,|\s|\)&#39;</span><span class="p">,</span><span class="n">n</span><span class="p">))))</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">n_sample</span><span class="p">]</span>   
            <span class="n">dimension</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;desc_dim\s*=\s*(\d+)&#39;</span><span class="p">,</span><span class="n">input_file</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            
            <span class="c1"># keywords for feature construction and sure independence screening</span>
            <span class="n">rung</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;rung\s*=\s*(\d+)&#39;</span><span class="p">,</span><span class="n">input_file</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">operation_set</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;opset\s*=\s*&#39;(.+)&#39;&quot;</span><span class="p">,</span><span class="n">input_file</span><span class="p">)</span>
            <span class="n">operation_set</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[\(\)]+&#39;</span><span class="p">,</span><span class="n">operation_set</span><span class="p">[</span><span class="mi">0</span><span class="p">])[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">maxcomplexity</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;maxcomplexity\s*=\s*(\d+)&#39;</span><span class="p">,</span><span class="n">input_file</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">dimclass</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;dimclass=([\(\d:\)]+)&#39;</span><span class="p">,</span><span class="n">input_file</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">maxfval_lb</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;maxfval_lb\s*=\s*(\d+.\d+|\d+[eE]-?\d+)&#39;</span><span class="p">,</span><span class="n">input_file</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">maxfval_ub</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;maxfval_ub\s*=\s*(\d+.\d+|\d+[eE]-?\d+)&#39;</span><span class="p">,</span><span class="n">input_file</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">subs_sis</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;subs_sis\s*=\s*(\d+)&#39;</span><span class="p">,</span><span class="n">input_file</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            
            <span class="c1"># keywords for descriptor</span>
            <span class="n">method</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;method\s*=\s*</span><span class="se">\&#39;</span><span class="s1">(\w+)&#39;</span><span class="p">,</span><span class="n">input_file</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">isconvex</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;isconvex\s*=\s*([\(\)\d,\s]*)\)&#39;</span><span class="p">,</span><span class="n">input_file</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">isconvex</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\(|\s&#39;</span><span class="p">,</span><span class="n">isconvex</span><span class="p">)</span>
            <span class="n">isconvex</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\d&#39;</span><span class="p">,</span><span class="n">x</span><span class="p">)),</span><span class="n">isconvex</span><span class="p">))</span>
            <span class="n">isconvex</span><span class="o">=</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">d</span><span class="p">),</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\d&#39;</span><span class="p">,</span><span class="n">x</span><span class="p">)),</span><span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;,|\s|\)&#39;</span><span class="p">,</span><span class="n">n</span><span class="p">))))</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">isconvex</span><span class="p">]</span>   
            <span class="n">width</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;width\s*=\s*(\d+.\d+|\d+[eE]-?\d+)&#39;</span><span class="p">,</span><span class="n">input_file</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">nm_output</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;nm_output\s*=\s*(\d+)&#39;</span><span class="p">,</span><span class="n">input_file</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        
        <span class="c1"># keywords for the target properties</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_task</span><span class="o">=</span><span class="n">n_task</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_sample</span><span class="o">=</span><span class="n">n_sample</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dimension</span><span class="o">=</span><span class="n">dimension</span>
        
        <span class="c1"># keywords for feature construction and sure independence screening</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rung</span><span class="o">=</span><span class="n">rung</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">operation_set</span><span class="o">=</span><span class="n">operation_set</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxcomplexity</span><span class="o">=</span><span class="n">maxcomplexity</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dimclass</span><span class="o">=</span><span class="n">dimclass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxfval_lb</span><span class="o">=</span><span class="n">maxfval_lb</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxfval_ub</span><span class="o">=</span><span class="n">maxfval_ub</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subs_sis</span><span class="o">=</span><span class="n">subs_sis</span>
        
        <span class="c1"># keywords for descriptor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">method</span><span class="o">=</span><span class="n">method</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">isconvex</span><span class="o">=</span><span class="n">isconvex</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="o">=</span><span class="n">width</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nm_output</span><span class="o">=</span><span class="n">nm_output</span>
        
        <span class="c1"># ------------------------------ read data --------------------------------</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_path</span><span class="p">,</span><span class="s1">&#39;train.dat&#39;</span><span class="p">),</span><span class="n">sep</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;\s+&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">features_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="mi">1</span><span class="p">:]</span>
        
        
        <span class="c1"># -------------------------- read data per task ----------------------------</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">data_sep</span><span class="o">=</span><span class="n">utils</span><span class="o">.</span><span class="n">seperate_DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">n_sample</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">materials_sep</span><span class="o">=</span><span class="n">utils</span><span class="o">.</span><span class="n">seperate_DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">n_sample</span><span class="p">)</span>
        
        <span class="c1"># ------------------------- read validation data ---------------------------</span>
        
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_path</span><span class="p">,</span><span class="s1">&#39;validation.dat&#39;</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">validation_data</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_path</span><span class="p">,</span><span class="s1">&#39;validation.dat&#39;</span><span class="p">),</span><span class="n">sep</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;\s+&#39;</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_path</span><span class="p">,</span><span class="s1">&#39;shuffle.dat&#39;</span><span class="p">),</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">shuffle</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">n_sample</span><span class="o">=</span><span class="n">shuffle</span><span class="p">[</span><span class="s1">&#39;training_samples_number&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">n_validation_sample</span><span class="o">=</span><span class="n">shuffle</span><span class="p">[</span><span class="s1">&#39;validation_samples_number&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">validation_data_task</span><span class="o">=</span><span class="n">utils</span><span class="o">.</span><span class="n">seperate_DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">validation_data</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">n_validation_sample</span><span class="p">)</span>

    
    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">text</span><span class="o">=</span><span class="s1">&#39;#&#39;</span><span class="o">*</span><span class="mi">50</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span><span class="s1">&#39;SISSO Classification</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span><span class="s1">&#39;#&#39;</span><span class="o">*</span><span class="mi">50</span>
        <span class="n">text</span><span class="o">+=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Sample Number: </span><span class="si">%d</span><span class="se">\n</span><span class="s1">Task Number: </span><span class="si">%d</span><span class="se">\n</span><span class="s1">Rung: </span><span class="si">%d</span><span class="se">\n</span><span class="s1">Dimension: </span><span class="si">%d</span><span class="se">\n</span><span class="s1">Subs_sis: </span><span class="si">%d</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_sample</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">n_task</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">rung</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">dimension</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">subs_sis</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">text</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    @property</span>
<span class="sd">    def baseline(self):</span>
<span class="sd">        r&quot;&quot;&quot;</span>
<span class="sd">        Returns the baseline, i.e., the errors with predicting every property using the mean value of the property in ``train.dat``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="sd">        </span>
<span class="sd">        errors=np.sort((self.property-self.property.mean()).abs().values)</span>
<span class="sd">        errors=np.array([self.property.mean(),</span>
<span class="sd">                        self.property.std(),</span>
<span class="sd">                        np.mean(errors),</span>
<span class="sd">                        np.percentile(errors,25),</span>
<span class="sd">                        np.percentile(errors,50),</span>
<span class="sd">                        np.percentile(errors,75),</span>
<span class="sd">                        np.percentile(errors,95),</span>
<span class="sd">                        errors[-1]])</span>
<span class="sd">        return pd.Series(errors,index=[&#39;mean&#39;,&#39;std&#39;,&#39;MAE&#39;,&#39;25%ile AE&#39;,&#39;50%ile AE&#39;,&#39;75%ile AE&#39;,&#39;95%ile AE&#39;,&#39;MaxAE&#39;])</span>
<span class="sd">    &#39;&#39;&#39;</span>
<div class="viewcode-block" id="Classification.get_descriptors"><a class="viewcode-back" href="../../SISSOkit.html#SISSOkit.evaluation.Classification.get_descriptors">[docs]</a>    <span class="k">def</span> <span class="nf">get_descriptors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns descriptors.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="n">path</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>
            <span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">current_path</span>
        <span class="n">descriptors_all</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s1">&#39;SISSO.out&#39;</span><span class="p">),</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">input_file</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="n">descriptors_total</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;descriptor:[\s\S]*?coefficients&#39;</span><span class="p">,</span><span class="n">input_file</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">dimension</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">dimension</span><span class="p">):</span>
                <span class="n">descriptors_d</span><span class="o">=</span><span class="n">descriptors_total</span><span class="p">[</span><span class="n">dimension</span><span class="p">]</span>
                <span class="n">descriptors_d</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\s+&#39;</span><span class="p">,</span><span class="n">descriptors_d</span><span class="p">)</span>
                <span class="n">descriptors_d</span><span class="o">=</span><span class="n">descriptors_d</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">dimension</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">descriptors_d</span><span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;:&#39;</span><span class="p">,</span><span class="n">x</span><span class="p">),</span><span class="n">descriptors_d</span><span class="p">))]</span>
                <span class="n">descriptors_d</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;(&#39;</span><span class="p">),</span><span class="n">descriptors_d</span><span class="p">))</span>
                <span class="n">descriptors_d</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;]&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;)&#39;</span><span class="p">),</span><span class="n">descriptors_d</span><span class="p">))</span>
                <span class="n">descriptors_all</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">descriptors_d</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">descriptors_all</span></div>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">descriptors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns descriptors.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_descriptors</span><span class="p">()</span>
    
<div class="viewcode-block" id="Classification.features_percent"><a class="viewcode-back" href="../../SISSOkit.html#SISSOkit.evaluation.Classification.features_percent">[docs]</a>    <span class="k">def</span> <span class="nf">features_percent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">descending</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Computes the percentages of each feature in top subs_sis 1D descriptors.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">feature_space</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_path</span><span class="p">,</span><span class="s1">&#39;feature_space&#39;</span><span class="p">,</span><span class="s1">&#39;Uspace.name&#39;</span><span class="p">),</span><span class="n">sep</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;\s+&#39;</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">subs_sis</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">feature_percent</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">features_name</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;percent&#39;</span><span class="p">,))</span>
        <span class="k">for</span> <span class="n">feature_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">features_name</span><span class="p">:</span>
            <span class="n">percent</span><span class="o">=</span><span class="n">feature_space</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">feature_name</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">subs_sis</span>
            <span class="n">feature_percent</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;percent&#39;</span><span class="p">,</span><span class="n">feature_name</span><span class="p">]</span><span class="o">=</span><span class="n">percent</span>
        <span class="n">feature_percent</span><span class="o">=</span><span class="n">feature_percent</span><span class="o">.</span><span class="n">T</span>
        <span class="k">if</span> <span class="n">descending</span><span class="p">:</span>
            <span class="n">feature_percent</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;percent&#39;</span><span class="p">,</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">feature_percent</span></div>
    
<div class="viewcode-block" id="Classification.evaluate_expression"><a class="viewcode-back" href="../../SISSOkit.html#SISSOkit.evaluation.Classification.evaluate_expression">[docs]</a>    <span class="k">def</span> <span class="nf">evaluate_expression</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">expression</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the value computed using given expression over data in ``train.dat``.</span>
<span class="sd">        </span>
<span class="sd">        Returns the values using ``expression`` to compute ``data``.</span>
<span class="sd">    </span>
<span class="sd">        Arguments:</span>
<span class="sd">            expression (string):  </span>
<span class="sd">                arithmetic expression. </span>
<span class="sd">                The expression should be in the same form as the descriptor in file ``SISSO.out``,</span>
<span class="sd">                i.e., every operation should be enclosed in parenthesis, like (exp((A+B))/((C*D))^2).</span>
<span class="sd">            </span>
<span class="sd">            data (pandas.DataFrame):  </span>
<span class="sd">                the data you want to compute, with samples as index and features as columns.</span>
<span class="sd">                The features name should be correspondent to the operands in expression.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            pandas.Series: values computed using ``expression``</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
            <span class="n">data</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data</span><span class="p">),</span><span class="n">sep</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;\s+&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">data</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span>
        <span class="k">return</span> <span class="n">evaluate_expression</span><span class="p">(</span><span class="n">expression</span><span class="p">,</span><span class="n">data</span><span class="p">)</span></div>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    def predict(self,data,tasks=None,dimensions=None):</span>
<span class="sd">        r&quot;&quot;&quot;</span>
<span class="sd">        Returns the predictions of ``data`` using the models found by SISSO.</span>
<span class="sd">        </span>
<span class="sd">        Arguments:</span>
<span class="sd">            data (string or pandas.DataFrame):  </span>
<span class="sd">                the path of the data or the data you want to compute. </span>
<span class="sd">                If it is :class:`string`, it will be recognized as path to the data and </span>
<span class="sd">                use ``data=pd.read_csv(data,sep=r&#39;\s+&#39;)`` to read the data, so remember to use space to seperate the data.</span>
<span class="sd">                Otherwise it should be :class:`pandas.DataFrame`.</span>
<span class="sd">            </span>
<span class="sd">            tasks (None or list):  </span>
<span class="sd">                specifies which sample should use which task of model to compute.</span>
<span class="sd">                It should be task=[ [task_index, [sample_indices] ] ].</span>
<span class="sd">                For example, [ [1, [1,3]], [2, [2,4,5]] ] means sample 1 and 3 will be computed using task 1 model,</span>
<span class="sd">                and sample 2, 4 and 5 will be computed using task 2 model.</span>
<span class="sd">                If it is None, then compute all samples with task 1 model.</span>
<span class="sd">            </span>
<span class="sd">            dimensions (None or list):  </span>
<span class="sd">                specifies which dimension of desctiptor will be used.</span>
<span class="sd">                For example, [2,5] means only compute using 2D and 5D models.</span>
<span class="sd">                If it is None, then compute all samples with all dimension models.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            Values computed using models found by SISSO.</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="sd">        </span>
<span class="sd">        if isinstance(data,str):</span>
<span class="sd">            data=pd.read_csv(os.path.join(data),sep=r&#39;\s+&#39;)</span>
<span class="sd">        return predict(data,self.descriptors,self.coefficients,self.intercepts,tasks=tasks,dimensions=dimensions)</span>
<span class="sd">    </span>
<span class="sd">    def predictions(self,training=True,display_task=False):</span>
<span class="sd">        r&quot;&quot;&quot;</span>
<span class="sd">        Returns predictions.</span>
<span class="sd">        The index order is dimension, sample if ``display_task`` is ``False``,</span>
<span class="sd">        or task, sample, dimension if ``display_task`` is ``True``.</span>
<span class="sd">        </span>
<span class="sd">        Arguments:</span>
<span class="sd">            training (bool):  </span>
<span class="sd">                determines whether its training or not.</span>
<span class="sd">            </span>
<span class="sd">            display_task (bool): </span>
<span class="sd">                determines the predictions contain index of task or not.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            Predictions.</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="sd">        </span>
<span class="sd">        if display_task==True:</span>
<span class="sd">            return compute_using_model(result=self,training=training)</span>
<span class="sd">        else:</span>
<span class="sd">            return np.hstack(compute_using_model(result=self,training=training))</span>
<span class="sd">    </span>
<span class="sd">    def errors(self,training=True,display_task=False):</span>
<span class="sd">        r&quot;&quot;&quot;</span>
<span class="sd">        Returns errors.</span>
<span class="sd">        The index order is dimension, sample if ``display_task`` is ``False``,</span>
<span class="sd">        or task, sample, dimension if ``display_task`` is ``True``.</span>
<span class="sd">        </span>
<span class="sd">        Arguments:</span>
<span class="sd">            training (bool):  </span>
<span class="sd">                determines whether its training or not.</span>
<span class="sd">            </span>
<span class="sd">            display_task (bool):  </span>
<span class="sd">                determines the errors contain index of task or not.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            Errors.</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="sd">        </span>
<span class="sd">        if display_task==True:</span>
<span class="sd">            pred=self.predictions(training=training,display_task=True)</span>
<span class="sd">            return [pred[task]-self.property_task[task].values for task in range(0,self.n_task)]</span>
<span class="sd">        else:</span>
<span class="sd">            if training==True:</span>
<span class="sd">                return self.predictions(training=training,display_task=False)-self.property.values</span>
<span class="sd">            else:</span>
<span class="sd">                return self.predictions(training=training,display_task=False)-self.validation_data.iloc[:,1].values</span>
<span class="sd">    </span>
<span class="sd">    def total_errors(self,training=True,display_task=False,display_baseline=False):</span>
<span class="sd">        r&quot;&quot;&quot;    </span>
<span class="sd">        Compute errors.</span>
<span class="sd">        </span>
<span class="sd">        Arguments:</span>
<span class="sd">            training (bool):  </span>
<span class="sd">                determines whether its training or not.</span>
<span class="sd">            </span>
<span class="sd">            display_task (bool):  </span>
<span class="sd">                determines the errors contain index of task or not.</span>
<span class="sd">            </span>
<span class="sd">            display_baseline (bool):  </span>
<span class="sd">                determines whether display baseline</span>
<span class="sd">            </span>
<span class="sd">        Returns:</span>
<span class="sd">            RMSE, MAE, 25%ile AE, 50%ile AE, 75%ile AE, 95%ile AE, MaxAE of given errors.</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="sd">        </span>
<span class="sd">        if display_baseline:</span>
<span class="sd">            return pd.concat([pd.DataFrame(self.baseline[1:].values,</span>
<span class="sd">                                        columns=[&#39;Baseline&#39;],</span>
<span class="sd">                                        index=[&#39;RMSE&#39;,&#39;MAE&#39;,&#39;25%ile AE&#39;,&#39;50%ile AE&#39;,&#39;75%ile AE&#39;,&#39;95%ile AE&#39;,&#39;MaxAE&#39;]).T,</span>
<span class="sd">                            compute_errors(self.errors(training=training,display_task=display_task))])</span>
<span class="sd">        else:</span>
<span class="sd">            return compute_errors(self.errors(training=training,display_task=display_task))</span>
<span class="sd">        </span>
<span class="sd">    def check_predictions(self,dimension,multiply_coefficients=True):</span>
<span class="sd">        r&quot;&quot;&quot;</span>
<span class="sd">        Checks predictions of each descriptor.</span>
<span class="sd">        </span>
<span class="sd">        Arguments:  </span>
<span class="sd">            dimension (int):</span>
<span class="sd">                dimension of the descriptor.</span>
<span class="sd">                </span>
<span class="sd">            multiply_coefficients (bool):  </span>
<span class="sd">                whether it should be multiplied by coefficients.</span>
<span class="sd">            </span>
<span class="sd">        Returns:</span>
<span class="sd">            Predictions of each descriptor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="sd">        </span>
<span class="sd">        descriptors=self.descriptors</span>
<span class="sd">        coefficients=self.coefficients</span>
<span class="sd">        n_sample=self.n_sample</span>
<span class="sd">        data=self.data_task</span>
<span class="sd">        predictions=np.zeros([dimension+1,np.array(n_sample).sum()])</span>
<span class="sd">        total_n_sample=0</span>
<span class="sd">        for task in range(len(n_sample)):</span>
<span class="sd">            predictions[0,total_n_sample:total_n_sample+n_sample[task]]=self.intercepts[task][dimension-1]</span>
<span class="sd">            total_n_sample+=n_sample[task]</span>
<span class="sd">        if multiply_coefficients:</span>
<span class="sd">            for d in range(dimension):</span>
<span class="sd">                total_n_sample=0</span>
<span class="sd">                for task in range(len(n_sample)):</span>
<span class="sd">                    predictions[d+1,total_n_sample:total_n_sample+n_sample[task]]=coefficients[task][dimension-1][d]*evaluate_expression(descriptors[dimension-1][d],data[task]).values</span>
<span class="sd">                    total_n_sample+=n_sample[task]</span>
<span class="sd">        else:</span>
<span class="sd">            for d in range(dimension):</span>
<span class="sd">                total_n_sample=0</span>
<span class="sd">                for task in range(len(n_sample)):</span>
<span class="sd">                    predictions[d+1,total_n_sample:total_n_sample+n_sample[task]]=evaluate_expression(descriptors[dimension-1][d],data[task]).values</span>
<span class="sd">                    total_n_sample+=n_sample[task]</span>
<span class="sd">        return predictions</span>
<span class="sd">    </span>
<span class="sd">    def check_percentage(self,dimension,absolute=True):</span>
<span class="sd">        r&quot;&quot;&quot;</span>
<span class="sd">        Checks percentage of each descriptors.</span>
<span class="sd">        </span>
<span class="sd">        Arguments:  </span>
<span class="sd">            dimension (int):</span>
<span class="sd">                dimension of the descriptor.</span>
<span class="sd">                </span>
<span class="sd">            absolute (bool):</span>
<span class="sd">                whether return the absolute descriptor.</span>
<span class="sd">                If it is ``True``, the numerator is absolute value of each descriptor multiplied by corresponding coefficient,</span>
<span class="sd">                and denominator is the sum of intercept and every descriptor multiplied by coefficient.</span>
<span class="sd">                If it is ``False``, the numerator is descriptor multiplied by corresponding coefficient,</span>
<span class="sd">                and denominator is the proeprty. In this case, sometimes it will be larger than 1.</span>
<span class="sd">                </span>
<span class="sd">        Returns:</span>
<span class="sd">            percentage which index is [dimension, sample].</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="sd">        </span>
<span class="sd">        predictions=self.check_predictions(dimension)</span>
<span class="sd">        if absolute:</span>
<span class="sd">            return np.abs(predictions)/np.sum(np.abs(predictions),axis=0)</span>
<span class="sd">        else:</span>
<span class="sd">            return predictions/self.property.values</span>
<span class="sd">    &#39;&#39;&#39;</span></div>






<div class="viewcode-block" id="ClassificationCV"><a class="viewcode-back" href="../../SISSOkit.html#SISSOkit.evaluation.ClassificationCV">[docs]</a><span class="k">class</span> <span class="nc">ClassificationCV</span><span class="p">(</span><span class="n">Classification</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Basic class for evaluating the cross validation results of classification.</span>
<span class="sd">    You should instantiate it first if you want to analyze CV results.</span>
<span class="sd">    You can use index to select a specific result from total CV results, and it will return</span>
<span class="sd">    a instance of :class:`Classification`.</span>
<span class="sd">    </span>
<span class="sd">    Arguments:</span>
<span class="sd">        current_path (string):  </span>
<span class="sd">            path to the directory of the cross validation results.</span>
<span class="sd">        </span>
<span class="sd">        property_name (string):  </span>
<span class="sd">            specifies the property name of your CV results.</span>
<span class="sd">        </span>
<span class="sd">        drop_index (list):  </span>
<span class="sd">            specifies which CV results you don&#39;t want to consider.</span>
<span class="sd">    </span>
<span class="sd">    .. note::</span>
<span class="sd">        You should use code in ``cross_validation.py`` to generate the CV files, otherwise the format</span>
<span class="sd">        may be wrong. </span>
<span class="sd">        </span>
<span class="sd">        Its attributes contain all the input arguments in ``SISSO.in``, information about ``train.dat``,</span>
<span class="sd">        ``validation.dat``, and ``SISSO.out``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">current_path</span><span class="p">,</span><span class="n">property_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">drop_index</span><span class="o">=</span><span class="p">[]):</span>
        <span class="c1"># -------------------------- read path and CV info----------------------------</span>
        <span class="n">cv_names</span><span class="o">=</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s1">&#39;_cv&#39;</span> <span class="ow">in</span> <span class="n">x</span><span class="p">,</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">current_path</span><span class="p">))),</span>
                        <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_cv&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">dir_list</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">cv_name</span><span class="p">:</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_path</span><span class="p">,</span><span class="n">cv_name</span><span class="p">),</span><span class="n">cv_names</span><span class="p">))</span>
        <span class="n">n_cv</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">cv_names</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">current_path</span><span class="o">=</span><span class="n">current_path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cv_path</span><span class="o">=</span><span class="p">[</span><span class="n">dir_list</span><span class="p">[</span><span class="n">cv</span><span class="p">]</span> <span class="k">for</span> <span class="n">cv</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_cv</span><span class="p">)</span> <span class="k">if</span> <span class="n">cv</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">drop_index</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">drop_index</span><span class="o">=</span><span class="n">drop_index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_cv</span><span class="o">=</span><span class="n">n_cv</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">drop_index</span><span class="p">)</span>
        
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_path</span><span class="p">,</span><span class="s1">&#39;cross_validation_info.dat&#39;</span><span class="p">),</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">cv_info</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cross_validation_type</span><span class="o">=</span><span class="n">cv_info</span><span class="p">[</span><span class="s1">&#39;cross_validation_type&#39;</span><span class="p">]</span>
        
        <span class="c1"># ------------------- read arguments of SISSO.in ----------------------------</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv_path</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="s1">&#39;SISSO.in&#39;</span><span class="p">),</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">input_file</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            
            <span class="c1"># keywords for the target properties</span>
            <span class="n">n_task</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;ntask\s*=\s*(\d+)&#39;</span><span class="p">,</span><span class="n">input_file</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">dimension</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;desc_dim\s*=\s*(\d+)&#39;</span><span class="p">,</span><span class="n">input_file</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            
            <span class="c1"># keywords for feature construction and sure independence screening</span>
            <span class="n">rung</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;rung\s*=\s*(\d+)&#39;</span><span class="p">,</span><span class="n">input_file</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">operation_set</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;opset\s*=\s*&#39;(.+)&#39;&quot;</span><span class="p">,</span><span class="n">input_file</span><span class="p">)</span>
            <span class="n">operation_set</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[\(\)]+&#39;</span><span class="p">,</span><span class="n">operation_set</span><span class="p">[</span><span class="mi">0</span><span class="p">])[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">maxcomplexity</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;maxcomplexity\s*=\s*(\d+)&#39;</span><span class="p">,</span><span class="n">input_file</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">dimclass</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;dimclass=([\(\d:\)]+)&#39;</span><span class="p">,</span><span class="n">input_file</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">maxfval_lb</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;maxfval_lb\s*=\s*(\d+.\d+|\d+[eE]-?\d+)&#39;</span><span class="p">,</span><span class="n">input_file</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">maxfval_ub</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;maxfval_ub\s*=\s*(\d+.\d+|\d+[eE]-?\d+)&#39;</span><span class="p">,</span><span class="n">input_file</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">subs_sis</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;subs_sis\s*=\s*(\d+)&#39;</span><span class="p">,</span><span class="n">input_file</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            
            <span class="c1"># keywords for descriptor</span>
            <span class="n">method</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;method\s*=\s*</span><span class="se">\&#39;</span><span class="s1">(\w+)&#39;</span><span class="p">,</span><span class="n">input_file</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">isconvex</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;isconvex\s*=\s*([\(\)\d,\s]*)\)&#39;</span><span class="p">,</span><span class="n">input_file</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">isconvex</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\(|\s&#39;</span><span class="p">,</span><span class="n">isconvex</span><span class="p">)</span>
            <span class="n">isconvex</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\d&#39;</span><span class="p">,</span><span class="n">x</span><span class="p">)),</span><span class="n">isconvex</span><span class="p">))</span>
            <span class="n">isconvex</span><span class="o">=</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">d</span><span class="p">),</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\d&#39;</span><span class="p">,</span><span class="n">x</span><span class="p">)),</span><span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;,|\s|\)&#39;</span><span class="p">,</span><span class="n">n</span><span class="p">))))</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">isconvex</span><span class="p">]</span>   
            <span class="n">width</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;width\s*=\s*(\d+.\d+|\d+[eE]-?\d+)&#39;</span><span class="p">,</span><span class="n">input_file</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">nm_output</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;nm_output\s*=\s*(\d+)&#39;</span><span class="p">,</span><span class="n">input_file</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        
        <span class="c1"># keywords for the target properties</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_task</span><span class="o">=</span><span class="n">n_task</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dimension</span><span class="o">=</span><span class="n">dimension</span>
        
        <span class="c1"># keywords for feature construction and sure independence screening</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rung</span><span class="o">=</span><span class="n">rung</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">operation_set</span><span class="o">=</span><span class="n">operation_set</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxcomplexity</span><span class="o">=</span><span class="n">maxcomplexity</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dimclass</span><span class="o">=</span><span class="n">dimclass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxfval_lb</span><span class="o">=</span><span class="n">maxfval_lb</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxfval_ub</span><span class="o">=</span><span class="n">maxfval_ub</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subs_sis</span><span class="o">=</span><span class="n">subs_sis</span>
        
        <span class="c1"># keywords for descriptor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">method</span><span class="o">=</span><span class="n">method</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">isconvex</span><span class="o">=</span><span class="n">isconvex</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="o">=</span><span class="n">width</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nm_output</span><span class="o">=</span><span class="n">nm_output</span>
        
        <span class="c1"># --------------------------- read total data -----------------------------</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">total_data</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_path</span><span class="p">,</span><span class="s1">&#39;train.dat&#39;</span><span class="p">),</span><span class="n">sep</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;\s+&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_total_sample</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_path</span><span class="p">,</span><span class="s1">&#39;train.dat&#39;</span><span class="p">),</span><span class="n">sep</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;\s+&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">property_name</span><span class="o">=</span><span class="n">property_name</span> <span class="k">if</span> <span class="n">property_name</span> <span class="k">else</span> <span class="n">cv_names</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_cv&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        
        <span class="c1"># -------------------------- read data per CV -----------------------------</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cv_path</span><span class="p">,</span><span class="s1">&#39;train.dat&#39;</span><span class="p">),</span><span class="n">sep</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;\s+&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">cv_path</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv_path</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="o">=</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">features_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="mi">2</span><span class="p">:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_sample</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cv_path</span><span class="p">,</span><span class="s1">&#39;shuffle.dat&#39;</span><span class="p">),</span><span class="s1">&#39;r&#39;</span><span class="p">))[</span><span class="s1">&#39;training_samples_number&#39;</span><span class="p">]</span>
                        <span class="k">for</span> <span class="n">cv_path</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv_path</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_validation_sample</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cv_path</span><span class="p">,</span><span class="s1">&#39;shuffle.dat&#39;</span><span class="p">),</span><span class="s1">&#39;r&#39;</span><span class="p">))[</span><span class="s1">&#39;validation_samples_number&#39;</span><span class="p">]</span>
                        <span class="k">for</span> <span class="n">cv_path</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv_path</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validation_data</span><span class="o">=</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cv_path</span><span class="p">,</span><span class="s1">&#39;validation.dat&#39;</span><span class="p">),</span><span class="n">sep</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;\s+&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">cv_path</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv_path</span><span class="p">]</span>
        
        <span class="c1"># --------------------- read data per CV per task ------------------------</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">data_task</span><span class="o">=</span><span class="p">[</span><span class="n">utils</span><span class="o">.</span><span class="n">seperate_DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">cv</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">n_sample</span><span class="p">[</span><span class="n">cv</span><span class="p">])</span>
                        <span class="k">for</span> <span class="n">cv</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">n_cv</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">materials_task</span><span class="o">=</span><span class="p">[</span><span class="n">utils</span><span class="o">.</span><span class="n">seperate_DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">materials</span><span class="p">[</span><span class="n">cv</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">n_sample</span><span class="p">[</span><span class="n">cv</span><span class="p">])</span>
                        <span class="k">for</span> <span class="n">cv</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">n_cv</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validation_data_task</span><span class="o">=</span><span class="p">[</span><span class="n">utils</span><span class="o">.</span><span class="n">seperate_DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">validation_data</span><span class="p">[</span><span class="n">cv</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">n_validation_sample</span><span class="p">[</span><span class="n">cv</span><span class="p">])</span>
                        <span class="k">for</span> <span class="n">cv</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">n_cv</span><span class="p">)]</span>
    
    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">index</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span><span class="nb">slice</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">Classification</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv_path</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">index</span><span class="o">.</span><span class="n">start</span><span class="p">,</span><span class="n">index</span><span class="o">.</span><span class="n">stop</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Classification</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv_path</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
    
    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">text</span><span class="o">=</span><span class="s1">&#39;#&#39;</span><span class="o">*</span><span class="mi">50</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span><span class="s1">&#39;SISSO Classification CV</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span><span class="s1">&#39;#&#39;</span><span class="o">*</span><span class="mi">50</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_path</span><span class="p">,</span><span class="s1">&#39;cross_validation_info.dat&#39;</span><span class="p">),</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">cv_info</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;shuffle_data_list&#39;</span> <span class="ow">in</span> <span class="n">cv_info</span><span class="p">:</span>
            <span class="n">text</span><span class="o">+=</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Cross Validation Type: </span><span class="si">%s</span><span class="se">\n</span><span class="s1">Shuffle Data List: &#39;</span><span class="o">%</span><span class="n">cv_info</span><span class="p">[</span><span class="s1">&#39;cross_validation_type&#39;</span><span class="p">]</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">cv_info</span><span class="p">[</span><span class="s1">&#39;shuffle_data_list&#39;</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">text</span><span class="o">+=</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Cross Validation Type: </span><span class="si">%s</span><span class="se">\n</span><span class="s1">Iteration: &#39;</span><span class="o">%</span><span class="n">cv_info</span><span class="p">[</span><span class="s1">&#39;cross_validation_type&#39;</span><span class="p">]</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_cv</span><span class="p">))</span>
        <span class="n">text</span><span class="o">+=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Task Number: </span><span class="si">%d</span><span class="se">\n</span><span class="s1">Rung: </span><span class="si">%d</span><span class="se">\n</span><span class="s1">Dimension: </span><span class="si">%d</span><span class="se">\n</span><span class="s1">Subs_sis: </span><span class="si">%d</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_task</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">rung</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">dimension</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">subs_sis</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">text</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    @property</span>
<span class="sd">    def baseline(self):</span>
<span class="sd">        r&quot;&quot;&quot;</span>
<span class="sd">        Returns the baseline, i.e., the errors with predicting every property using the mean value of the property in ``train.dat``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="sd">        </span>
<span class="sd">        total_property=self.total_data.iloc[:,1]</span>
<span class="sd">        errors=np.sort((total_property-total_property.mean()).abs().values)</span>
<span class="sd">        errors=np.array([total_property.mean(),</span>
<span class="sd">                        total_property.std(),</span>
<span class="sd">                        np.mean(errors),</span>
<span class="sd">                        np.percentile(errors,25),</span>
<span class="sd">                        np.percentile(errors,50),</span>
<span class="sd">                        np.percentile(errors,75),</span>
<span class="sd">                        np.percentile(errors,95),</span>
<span class="sd">                        errors[-1]])</span>
<span class="sd">        return pd.Series(errors,index=[&#39;mean&#39;,&#39;std&#39;,&#39;MAE&#39;,&#39;25%ile AE&#39;,&#39;50%ile AE&#39;,&#39;75%ile AE&#39;,&#39;95%ile AE&#39;,&#39;MaxAE&#39;])</span>
<span class="sd">    &#39;&#39;&#39;</span>
<div class="viewcode-block" id="ClassificationCV.find_materials_in_validation"><a class="viewcode-back" href="../../SISSOkit.html#SISSOkit.evaluation.ClassificationCV.find_materials_in_validation">[docs]</a>    <span class="k">def</span> <span class="nf">find_materials_in_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">*</span><span class="n">idxs</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the samples&#39; names and in which CV result they are.</span>
<span class="sd">        </span>
<span class="sd">        Arguments:</span>
<span class="sd">            idx (integer):  </span>
<span class="sd">                index of the sample.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            the samples&#39; names and in which CV result they are.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cross_validation_type</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;leave&#39;</span><span class="p">):</span>
            <span class="n">val_num</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">validation_data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">return</span> <span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">validation_data</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">index</span><span class="o">/</span><span class="n">val_num</span><span class="p">)]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">index</span><span class="o">%</span><span class="n">val_num</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">idxs</span><span class="p">],</span>
                    <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv_path</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">index</span><span class="o">/</span><span class="n">val_num</span><span class="p">)]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;cv&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">idxs</span><span class="p">])</span></div>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    def find_max_error(self):</span>
<span class="sd">        r&quot;&quot;&quot;</span>
<span class="sd">        Returns the samples&#39; names and in which CV result they are that contribute to the maxAE.</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="sd">        </span>
<span class="sd">        return self.find_materials_in_validation(*(np.argmax(np.abs(self.errors(training=False)),axis=1)))</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">descriptors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns descriptors. The first index is cross validation index.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">return</span> <span class="p">[</span><span class="nb">super</span><span class="p">(</span><span class="n">ClassificationCV</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_descriptors</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">cv_path</span><span class="p">)</span> <span class="k">for</span> <span class="n">cv_path</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv_path</span><span class="p">]</span>
    
<div class="viewcode-block" id="ClassificationCV.features_percent"><a class="viewcode-back" href="../../SISSOkit.html#SISSOkit.evaluation.ClassificationCV.features_percent">[docs]</a>    <span class="k">def</span> <span class="nf">features_percent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">descending</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the percent of each feature in the top subs_sis descriptors.</span>
<span class="sd">        There are total n_cv*subs_sis descriptors,</span>
<span class="sd">        the feature percent is the percent over these descriptors.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">feature_percent</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">features_name</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;percent&#39;</span><span class="p">,))</span>
        <span class="n">feature_percent</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">for</span> <span class="n">cv_path</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv_path</span><span class="p">:</span>
            <span class="n">feature_space</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cv_path</span><span class="p">,</span><span class="s1">&#39;feature_space&#39;</span><span class="p">,</span><span class="s1">&#39;Uspace.name&#39;</span><span class="p">),</span><span class="n">sep</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;\s+&#39;</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">subs_sis</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">feature_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">features_name</span><span class="p">:</span>
                <span class="n">count</span><span class="o">=</span><span class="n">feature_space</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">feature_name</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                <span class="n">feature_percent</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;percent&#39;</span><span class="p">,</span><span class="n">feature_name</span><span class="p">]</span><span class="o">+=</span><span class="n">count</span>
        <span class="n">feature_percent</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span><span class="o">=</span><span class="n">feature_percent</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_cv</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">subs_sis</span><span class="p">)</span>
        <span class="n">feature_percent</span><span class="o">=</span><span class="n">feature_percent</span><span class="o">.</span><span class="n">T</span>
        <span class="k">if</span> <span class="n">descending</span><span class="p">:</span>
            <span class="n">feature_percent</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;percent&#39;</span><span class="p">,</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">feature_percent</span></div>
    
<div class="viewcode-block" id="ClassificationCV.descriptor_percent"><a class="viewcode-back" href="../../SISSOkit.html#SISSOkit.evaluation.ClassificationCV.descriptor_percent">[docs]</a>    <span class="k">def</span> <span class="nf">descriptor_percent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">descriptor</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the percent of given descriptor appearing in the cross validation top subs_sis descriptors,</span>
<span class="sd">        and return the appearing index in the descriptor space.</span>
<span class="sd">        </span>
<span class="sd">        Arguments:</span>
<span class="sd">            descriptor (string):  </span>
<span class="sd">                the descriptor you want to check.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">count</span><span class="o">=</span><span class="mi">0</span>
        <span class="n">descriptor_index</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_cv</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">cv</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">n_cv</span><span class="p">):</span>
            <span class="n">feature_space</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv_path</span><span class="p">[</span><span class="n">cv</span><span class="p">],</span><span class="s1">&#39;feature_space&#39;</span><span class="p">,</span><span class="s1">&#39;Uspace.name&#39;</span><span class="p">),</span><span class="n">sep</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;\s+&#39;</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">subs_sis</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">descriptor_index</span><span class="p">[</span><span class="n">cv</span><span class="p">]</span><span class="o">=</span><span class="n">feature_space</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">descriptor</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>
                <span class="n">count</span><span class="o">+=</span><span class="mi">1</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="n">descriptor_index</span><span class="p">[</span><span class="n">cv</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span>
        <span class="k">return</span> <span class="n">count</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">n_cv</span><span class="p">,</span><span class="n">descriptor_index</span></div>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    def predict(self,data,cv_index=None,tasks=None,dimensions=None):</span>
<span class="sd">        r&quot;&quot;&quot;</span>
<span class="sd">        Returns the predictions of ``data`` using the models found by SISSO.</span>
<span class="sd">        </span>
<span class="sd">        Arguments:</span>
<span class="sd">            data (string or pandas.DataFrame):  </span>
<span class="sd">                the path of the data or the data you want to compute. </span>
<span class="sd">                If it is :class:`string`, it will be recognized as path to the data and </span>
<span class="sd">                use ``data=pd.read_csv(data,sep=r&#39;\s+&#39;)`` to read the data, so remember to use space to seperate the data.</span>
<span class="sd">                Otherwise it should be :class:`pandas.DataFrame`.</span>
<span class="sd">            </span>
<span class="sd">            cv_index (None or list): </span>
<span class="sd">                specifies which CV should be included.</span>
<span class="sd">                For example, [1,5] means CV1 and CV5 will be included.</span>
<span class="sd">                If it is None, then compute all CV results.</span>
<span class="sd">            </span>
<span class="sd">            tasks (None or list):  </span>
<span class="sd">                specifies which sample should use which task of model to compute.</span>
<span class="sd">                It should be task=[ [task_index, [sample_indices] ] ].</span>
<span class="sd">                For example, [ [1, [1,3]], [2, [2,4,5]] ] means sample 1 and 3 will be computed using task 1 model,</span>
<span class="sd">                and sample 2, 4 and 5 will be computed using task 2 model.</span>
<span class="sd">                If it is None, then compute all samples with task 1 model.</span>
<span class="sd">            </span>
<span class="sd">            dimensions (None or list):  </span>
<span class="sd">                specifies which dimension of desctiptor will be used.</span>
<span class="sd">                For example, [2,5] means only compute using 2D and 5D models.</span>
<span class="sd">                If it is None, then compute all samples with all dimension models.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            Values computed using models found by SISSO.</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="sd">        </span>
<span class="sd">        if cv_index==None:</span>
<span class="sd">            cv_index=list(range(self.n_cv))</span>
<span class="sd">        </span>
<span class="sd">        return [predict_reg(data,self.descriptors[cv],self.coefficients[cv],self.intercepts[cv],tasks=tasks,dimensions=dimensions)</span>
<span class="sd">                for cv in cv_index]</span>
<span class="sd">    </span>
<span class="sd">    def predictions(self,training=True,display_cv=False,display_task=False):</span>
<span class="sd">        r&quot;&quot;&quot;</span>
<span class="sd">        Returns predictions.</span>
<span class="sd">        The index order is dimension, sample if ``display_cv`` is ``False`` and ``display_task`` is ``False``,</span>
<span class="sd">        or task, sample, dimension if ``display_cv`` is ``False`` and ``display_task`` is ``True``,</span>
<span class="sd">        or CV index, sample, dimension if ``display_cv`` is ``True`` and ``display_task`` is ``False``,</span>
<span class="sd">        or CV index, task, sample, dimension if ``display_cv`` is ``True`` and ``display_task`` is ``True``.</span>
<span class="sd">        </span>
<span class="sd">        Arguments:</span>
<span class="sd">            training (bool):  </span>
<span class="sd">                determines whether its training or not.</span>
<span class="sd">            </span>
<span class="sd">            display_task (bool):  </span>
<span class="sd">                determines the predictions contain index of task or not.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            Predictions.</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="sd">        </span>
<span class="sd">        if display_cv==True:</span>
<span class="sd">            if display_task==True:</span>
<span class="sd">                return [compute_using_model_reg(path=cv_path,</span>
<span class="sd">                                        training=training)</span>
<span class="sd">                for cv_path in self.cv_path]</span>
<span class="sd">            else:</span>
<span class="sd">                return [np.hstack(compute_using_model_reg(path=cv_path,</span>
<span class="sd">                                        training=training))</span>
<span class="sd">                for cv_path in self.cv_path]</span>
<span class="sd">        else:</span>
<span class="sd">            return np.hstack(self.predictions(training=training,display_cv=True,display_task=False))</span>
<span class="sd">    </span>
<span class="sd">    def errors(self,training=True,display_cv=False,display_task=False):</span>
<span class="sd">        r&quot;&quot;&quot;</span>
<span class="sd">        Returns errors.</span>
<span class="sd">        The index order is dimension, sample if ``display_cv`` is ``False`` and ``display_task`` is ``False``,</span>
<span class="sd">        or task, sample, dimension if ``display_cv`` is ``False`` and ``display_task`` is ``True``,</span>
<span class="sd">        or CV index, sample, dimension if ``display_cv`` is ``True`` and ``display_task`` is ``False``,</span>
<span class="sd">        or CV index, task, sample, dimension if ``display_cv`` is ``True`` and ``display_task`` is ``True``.</span>
<span class="sd">        </span>
<span class="sd">        Arguments:</span>
<span class="sd">            training (bool):  </span>
<span class="sd">                determines whether its training or not.</span>
<span class="sd">            </span>
<span class="sd">            display_task (bool):  </span>
<span class="sd">                determines the errors contain index of task or not.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            Errors.</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="sd">        </span>
<span class="sd">        if display_cv:</span>
<span class="sd">            if training:</span>
<span class="sd">                if display_task:</span>
<span class="sd">                    error=[]</span>
<span class="sd">                    pred=self.predictions(training=True,display_cv=True,display_task=True)</span>
<span class="sd">                    for cv in range(self.n_cv):</span>
<span class="sd">                        error_cv=[]</span>
<span class="sd">                        for task in range(0,self.n_task):</span>
<span class="sd">                            error_cv.append(pred[cv][task]-self.property_task[cv][task])</span>
<span class="sd">                        error.append(error_cv)</span>
<span class="sd">                    return error</span>
<span class="sd">                else:</span>
<span class="sd">                    pred=self.predictions(training=True,display_cv=True,display_task=True)</span>
<span class="sd">                    return [np.hstack(pred[cv])-np.hstack(self.property_task[cv])</span>
<span class="sd">                            for cv in range(self.n_cv)]</span>
<span class="sd">            else:</span>
<span class="sd">                if display_task:</span>
<span class="sd">                    error=[]</span>
<span class="sd">                    pred=self.predictions(training=False,display_cv=True,display_task=True)</span>
<span class="sd">                    for cv in range(0,self.n_cv):</span>
<span class="sd">                        error_cv=[]</span>
<span class="sd">                        for task in range(self.n_task):</span>
<span class="sd">                            error_cv.append(pred[cv][task]-self.validation_data_task[cv][task].iloc[:,1].values)</span>
<span class="sd">                        error.append(error_cv)</span>
<span class="sd">                    return error</span>
<span class="sd">                else:</span>
<span class="sd">                    pred=self.predictions(training=False,display_cv=True,display_task=True)</span>
<span class="sd">                    return [(np.hstack(pred[cv])-self.validation_data[cv].iloc[:,1].values)</span>
<span class="sd">                            for cv in range(self.n_cv)]</span>
<span class="sd">        else:</span>
<span class="sd">            if display_task:</span>
<span class="sd">                errors_cv_t=self.errors(training=training,display_cv=True,display_task=True)</span>
<span class="sd">                errors=[]</span>
<span class="sd">                for task in range(self.n_task):</span>
<span class="sd">                    errors_t=errors_cv_t[0][task]</span>
<span class="sd">                    for cv in range(1,self.n_cv):</span>
<span class="sd">                        errors_t=np.hstack((errors_t,errors_cv_t[cv][task]))</span>
<span class="sd">                    errors.append(errors_t)</span>
<span class="sd">                return errors</span>
<span class="sd">            else:</span>
<span class="sd">                return np.hstack(self.errors(training=training,display_cv=True,display_task=False))</span>
<span class="sd">        </span>
<span class="sd">    def total_errors(self,training=True,display_cv=False,display_task=False,display_baseline=False):</span>
<span class="sd">        r&quot;&quot;&quot;    </span>
<span class="sd">        Compute errors.</span>
<span class="sd">        </span>
<span class="sd">        Arguments:</span>
<span class="sd">            training (bool):  </span>
<span class="sd">                determines whether its training or not.</span>
<span class="sd">            </span>
<span class="sd">            display_cv (bool):  </span>
<span class="sd">                determines the errors contain index of CV or not.</span>
<span class="sd">            </span>
<span class="sd">            display_task (bool):  </span>
<span class="sd">                determines the errors contain index of task or not.</span>
<span class="sd">            </span>
<span class="sd">            display_baseline (bool):  </span>
<span class="sd">                determines whether display baseline</span>
<span class="sd">            </span>
<span class="sd">        Returns:</span>
<span class="sd">            RMSE, MAE, 25%ile AE, 50%ile AE, 75%ile AE, 95%ile AE, MaxAE of given errors.</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="sd">        </span>
<span class="sd">        if display_baseline:</span>
<span class="sd">            if training:</span>
<span class="sd">                return pd.concat([pd.DataFrame(self.baseline[1:].values,</span>
<span class="sd">                                        columns=[&#39;Baseline&#39;],</span>
<span class="sd">                                        index=[&#39;RMSE&#39;,&#39;MAE&#39;,&#39;25%ile AE&#39;,&#39;50%ile AE&#39;,&#39;75%ile AE&#39;,&#39;95%ile AE&#39;,&#39;MaxAE&#39;]).T,</span>
<span class="sd">                                compute_errors(self.errors(training=training,display_cv=display_cv,display_task=display_task))])</span>
<span class="sd">            else:</span>
<span class="sd">                return pd.concat([pd.DataFrame(self.baseline[1:].values,</span>
<span class="sd">                                        columns=[&#39;Baseline&#39;],</span>
<span class="sd">                                        index=[&#39;RMSE&#39;,&#39;MAE&#39;,&#39;25%ile AE&#39;,&#39;50%ile AE&#39;,&#39;75%ile AE&#39;,&#39;95%ile AE&#39;,&#39;MaxAE&#39;]).T,</span>
<span class="sd">                                compute_errors(self.errors(training=training,display_cv=display_cv,display_task=display_task))])</span>
<span class="sd">        else:</span>
<span class="sd">            if training:</span>
<span class="sd">                return compute_errors(self.errors(training=training,display_cv=display_cv,display_task=display_task))</span>
<span class="sd">            else:</span>
<span class="sd">                return compute_errors(self.errors(training=training,display_cv=display_cv,display_task=display_task))</span>
<span class="sd">    &#39;&#39;&#39;</span>
<div class="viewcode-block" id="ClassificationCV.drop"><a class="viewcode-back" href="../../SISSOkit.html#SISSOkit.evaluation.ClassificationCV.drop">[docs]</a>    <span class="k">def</span> <span class="nf">drop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="p">[]):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Drop some CV results.</span>
<span class="sd">        </span>
<span class="sd">        Arguments:</span>
<span class="sd">            index (list):  </span>
<span class="sd">                contain the CV index which you want to drop.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            An instance of RegressionCV that drop the results in CV index.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">index</span><span class="o">+=</span><span class="bp">self</span><span class="o">.</span><span class="n">drop_index</span>
        <span class="k">return</span> <span class="n">ClassificationCV</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_path</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">property_name</span><span class="p">,</span><span class="n">index</span><span class="p">)</span></div>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    def check_predictions(self,cv_idx,dimension,training=True,multiply_coefficients=True):</span>
<span class="sd">        r&quot;&quot;&quot;</span>
<span class="sd">        Check predictions of each descriptor.</span>
<span class="sd">        </span>
<span class="sd">        Arguments:</span>
<span class="sd">            cv_idx (integer):  </span>
<span class="sd">                specifies which CV result you want to check.</span>
<span class="sd">                </span>
<span class="sd">            dimension (int):</span>
<span class="sd">                dimension of the descriptor.</span>
<span class="sd">            </span>
<span class="sd">            training (bool):  </span>
<span class="sd">                whether it is training.</span>
<span class="sd">            </span>
<span class="sd">            multiply_coefficients (bool):  </span>
<span class="sd">                whether it should be multiplied by coefficients.</span>
<span class="sd">            </span>
<span class="sd">        Returns</span>
<span class="sd">            Predictions of each descriptor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="sd">        </span>
<span class="sd">        descriptors=self.descriptors[cv_idx]</span>
<span class="sd">        coefficients=self.coefficients[cv_idx]</span>
<span class="sd">        if training:</span>
<span class="sd">            n_sample=self.n_sample[cv_idx]</span>
<span class="sd">            data=self.data_task[cv_idx]</span>
<span class="sd">        else:</span>
<span class="sd">            n_sample=self.n_validation_sample[cv_idx]</span>
<span class="sd">            data=self.validation_data_task[cv_idx]</span>
<span class="sd">        predictions=np.zeros([n_sample.sum(),dimension+1])</span>
<span class="sd">        total_n_sample=0</span>
<span class="sd">        for task in range(len(n_sample)):</span>
<span class="sd">            predictions[total_n_sample:total_n_sample+n_sample[task],0]=self.intercepts[cv_idx][task][dimension-1]</span>
<span class="sd">            total_n_sample+=n_sample[task]</span>
<span class="sd">        if multiply_coefficients:</span>
<span class="sd">            for d in range(dimension):</span>
<span class="sd">                total_n_sample=0</span>
<span class="sd">                for task in range(len(n_sample)):</span>
<span class="sd">                    predictions[total_n_sample:total_n_sample+n_sample[task],d+1]=coefficients[task][dimension-1][d]*evaluate_expression(descriptors[dimension-1][d],data[task]).values</span>
<span class="sd">                    total_n_sample+=n_sample[task]</span>
<span class="sd">        else:</span>
<span class="sd">            for d in range(dimension):</span>
<span class="sd">                total_n_sample=0</span>
<span class="sd">                for task in range(len(n_sample)):</span>
<span class="sd">                    predictions[total_n_sample:total_n_sample+n_sample[task],d+1]=evaluate_expression(descriptors[dimension-1][d],data[task]).values</span>
<span class="sd">                    total_n_sample+=n_sample[task]</span>
<span class="sd">        return predictions</span>
<span class="sd">        </span>
<span class="sd">    def check_percentage(self,cv_idx,dimension,absolute=True):</span>
<span class="sd">        r&quot;&quot;&quot;</span>
<span class="sd">        Checks percentage of each descriptors.</span>
<span class="sd">        </span>
<span class="sd">        Arguments:  </span>
<span class="sd">            dimension (int):</span>
<span class="sd">                dimension of the descriptor.</span>
<span class="sd">                </span>
<span class="sd">            absolute (bool):</span>
<span class="sd">                whether return the absolute descriptor.</span>
<span class="sd">                If it is ``True``, the numerator is absolute value of each descriptor multiplied by corresponding coefficient,</span>
<span class="sd">                and denominator is the sum of intercept and every descriptor multiplied by coefficient.</span>
<span class="sd">                If it is ``False``, the numerator is descriptor multiplied by corresponding coefficient,</span>
<span class="sd">                and denominator is the proeprty. In this case, sometimes it will be larger than 1.</span>
<span class="sd">                </span>
<span class="sd">        Returns:</span>
<span class="sd">            percentage which index is [dimension, sample].</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="sd">        </span>
<span class="sd">        predictions=self.check_predictions(cv_idx,dimension)</span>
<span class="sd">        if absolute:</span>
<span class="sd">            return np.abs(predictions)/np.sum(np.abs(predictions),axis=0)</span>
<span class="sd">        else:</span>
<span class="sd">            return predictions/self.property[cv_idx].values</span>
<span class="sd">    &#39;&#39;&#39;</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Chuanqi Xu

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>